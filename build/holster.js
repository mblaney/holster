var te={is:e=>{if(e instanceof Array)return!1;if(typeof e=="number")return!isNaN(e);if(typeof e=="string"){let t=parseFloat(e);return!isNaN(t)&&isFinite(t)}return!1}},C={is:e=>{if(!e||typeof e!="object")return!1;let r=Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/);return e.constructor===Object||r&&r[1]==="Object"},map:(e,t,r)=>{var n=Object.keys(e);for(let i=0;i<n.length;i++){let u=t(e[n[i]],n[i],r);if(typeof u<"u")return u}},put:(e,t,r)=>(e||(e={}),e[t]=r,e),del:(e,t)=>{if(e)return e[t]=null,delete e[t],e}},Ne=(e,t,r)=>{if(r.id){r.id=!1;return}if(t==="#"&&typeof e=="string"){r.id=e;return}r.id=!1},N={is:e=>{if(e&&e["#"]&&!e._&&C.is(e)){let t={};if(C.map(e,Ne,t),t.id)return t.id}return!1},ify:e=>C.put({},"#",e)},P="_holster_user_signature",F="_holster_user_public_key",q=(e,t,r,n)=>{let i=Date.now(),u={[e]:{_:{"#":e,">":{}}}};for(let[l,f]of Object.entries(t))l!=="_"&&l!==F&&l!==P&&(u[e][l]=f,u[e]._[">"][l]=i);return r&&n&&(u[e][P]=r,u[e]._[">"][P]=i,u[e][F]=n,u[e]._[">"][F]=i),u},z=(e,t)=>{if(typeof t>"u")return e===null;if(typeof e>"u")return!0;if(typeof e=="string")return e===t;if(!C.is(e)||!t)return!1;let r=e["*"];if(r)return t.slice(0,r.length)===r;let n=e[">"],i=e["<"];return n&&i?t>=n&&t<=i:n?t>=n:i?t<=i:!1},_={random:e=>{var t="";let r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";e||(e=24);for(let n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}};var Me=e=>{e||(e=9e3);let t={store:{}};return t.check=r=>t.store[r]?t.track(r):!1,t.track=r=>(t.store[r]=Date.now(),t.expiry||(t.expiry=setTimeout(()=>{if(t.expiry)return;let n=Date.now();Object.keys(t.store).forEach(i=>{n-t.store[i]>e&&delete t.store[i]}),t.expiry=null},e)),r),t},me=Me;var Be=(e,t)=>{if(!e||typeof e!="object")throw new TypeError("lex must be an object");if(!t||typeof t!="object")throw new TypeError("graph must be an object");let r=e["#"];if(!r||typeof r!="string")throw new TypeError("soul must be a string");if(!t[r])return;let n={_:{"#":r,">":{}}};if(typeof e["."]=="string"){let i=e["."];if(typeof t[r][i]>"u")return;n[i]=t[r][i],n._[">"][i]=t[r]._[">"][i]}else for(let i of Object.keys(t[r]))z(e["."],i)&&(n[i]=t[r][i],n._[">"][i]=t[r]._[">"][i]);return{[r]:n}},fe=Be;typeof btoa>"u"&&(globalThis.btoa=e=>Buffer.from(e,"binary").toString("base64"),globalThis.atob=e=>Buffer.from(e,"base64").toString("binary"));function re(){}Object.assign(re,{from:Array.from});re.prototype=Object.create(Array.prototype);re.prototype.toString=function(e,t,r){if(e||(e="utf8"),t||(t=0),r=r?Math.min(Math.max(r,t),this.length):this.length,e==="hex"){let n=new Uint8Array(this.slice(t,r));return Array.from(n,i=>i.toString(16).padStart(2,"0")).join("")}if(e==="utf8")return Array.from({length:r-t},(n,i)=>{let u=this[i+t];return u<0||u>1114111?"\uFFFD":String.fromCharCode(u)}).join("");if(e==="base64"){let n=Array.from({length:r-t},(i,u)=>{let l=this[u+t];return l<0||l>255?"\uFFFD":String.fromCharCode(l)}).join("");return btoa(n)}};var L=re;var ne={MAX_BUFFER_SIZE:10*1024*1024,MAX_STRING_LENGTH:1024*1024};function W(...e){return console.warn("new SafeBuffer() is deprecated, please use SafeBuffer.from()"),W.from(...e)}W.prototype=Object.create(Array.prototype);var Q=(e,t)=>{if(typeof e!="string")throw new TypeError("Input must be a string for encoding: "+t);if(e.length>ne.MAX_STRING_LENGTH)throw new RangeError(`String too large: ${e.length} > ${ne.MAX_STRING_LENGTH}`)},H=(e,t="buffer operation")=>{if(e>ne.MAX_BUFFER_SIZE)throw new RangeError(`Buffer size too large for ${t}: ${e} > ${ne.MAX_BUFFER_SIZE}`)},Ue=e=>{Q(e,"hex");let t=e.replace(/\s/g,"").toLowerCase();if(!/^[0-9a-f]*$/.test(t))throw new TypeError("Invalid hex string: contains non-hex characters");if(t.length%2!==0)throw new TypeError("Invalid hex string: must have even length");if(t.length===0)return new Uint8Array(0);H(t.length/2,"hex parsing");let r=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2){let i=t.substr(n,2);r[n/2]=parseInt(i,16)}return r},we=e=>{Q(e,"utf8");try{let r=new TextEncoder().encode(e);return H(r.length,"UTF-8 encoding"),r}catch(t){throw new TypeError("Failed to encode UTF-8 string: "+t.message)}},Fe=e=>{Q(e,"binary"),H(e.length,"binary encoding");let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(n>255)throw new TypeError(`Invalid binary string: character at position ${r} exceeds byte range (${n} > 255)`);t[r]=n}return t},Re=e=>{Q(e,"base64");let t=e.replace(/\s/g,"");if(!/^[A-Za-z0-9+/]*={0,2}$/.test(t))throw new TypeError("Invalid base64 string: contains invalid characters");try{let r=atob(t);H(r.length,"base64 decoding");let n=new Uint8Array(r.length);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return n}catch(r){throw new TypeError("Failed to decode base64 string: "+r.message)}},be=e=>{let t;if(e instanceof ArrayBuffer)H(e.byteLength,"ArrayBuffer processing"),t=new Uint8Array(e);else if(ArrayBuffer.isView(e))H(e.byteLength||e.length,"TypedArray processing"),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);else if(Array.isArray(e)){H(e.length,"Array processing");for(let r=0;r<e.length;r++){let n=e[r];if(typeof n!="number"||n<0||n>255||!Number.isInteger(n))throw new TypeError(`Invalid byte value at index ${r}: ${n} (must be integer 0-255)`)}t=new Uint8Array(e)}else if(typeof e=="object"&&e!==null&&typeof e.length=="number"){H(e.length,"array-like processing");let r=Array.from(e);for(let n=0;n<r.length;n++){let i=r[n];if(typeof i!="number"||i<0||i>255||!Number.isInteger(i))throw new TypeError(`Invalid byte value at index ${n}: ${i} (must be integer 0-255)`)}t=new Uint8Array(r)}else throw new TypeError("Unsupported input type: "+typeof e);return t};Object.assign(W,{from(){if(arguments.length===0)throw new TypeError("SafeBuffer.from() requires at least one argument");let t=arguments[0];if(t==null)throw new TypeError("First argument must not be null or undefined");let r;if(typeof t=="string"){let n=(arguments[1]||"utf8").toLowerCase();switch(n){case"hex":r=Ue(t);break;case"utf8":case"utf-8":r=we(t);break;case"binary":case"latin1":r=Fe(t);break;case"base64":r=Re(t);break;case"ascii":Q(t,"ascii");for(let i=0;i<t.length;i++)if(t.charCodeAt(i)>127)throw new TypeError(`Invalid ASCII character at position ${i}: ${t.charCodeAt(i)} > 127`);r=we(t);break;default:throw new TypeError("Unknown encoding: "+n)}}else r=be(t);if(!r||r.length===0)return L.from(new Uint8Array(0));try{return L.from(r)}catch(n){throw new Error("Failed to create SafeBuffer: "+n.message)}},alloc(e,t=0){if(typeof e!="number"||!Number.isInteger(e)||e<0)throw new TypeError("Length must be a non-negative integer");if(H(e,"buffer allocation"),typeof t=="number"){if(t<0||t>255||!Number.isInteger(t))throw new TypeError("Fill value must be an integer between 0 and 255")}else if(typeof t=="string"){if(t.length!==1)throw new TypeError("Fill string must be exactly one character");if(t=t.charCodeAt(0),t>255)throw new TypeError("Fill character code must be <= 255")}else throw new TypeError("Fill must be a number or single character string");try{let r=new Uint8Array(e);return t!==0&&r.fill(t),L.from(r)}catch(r){throw new Error("Failed to allocate buffer: "+r.message)}},concat(e){if(!Array.isArray(e))throw new TypeError("First argument must be an array");if(e.length===0)return L.from(new Uint8Array(0));let t=0,r=[];for(let n=0;n<e.length;n++){let i=e[n];if(!i)throw new TypeError(`Array element at index ${n} is null or undefined`);let u;try{u=be(i)}catch(l){throw new TypeError(`Invalid array element at index ${n}: ${l.message}`)}t+=u.length,H(t,"buffer concatenation"),r.push(u)}try{let n=new Uint8Array(t),i=0;for(let u of r)n.set(u,i),i+=u.length;return L.from(n)}catch(n){throw new Error("Failed to concatenate buffers: "+n.message)}},isBuffer(e){return e instanceof L||e&&typeof e=="object"&&e.constructor===W},byteLength(e,t="utf8"){if(typeof e!="string")throw new TypeError("First argument must be a string");switch(t.toLowerCase()){case"utf8":case"utf-8":return new TextEncoder().encode(e).length;case"ascii":case"binary":case"latin1":return e.length;case"base64":let r=e.replace(/\s/g,"");return Math.floor(r.length*3/4)-(r.match(/=/g)||[]).length;case"hex":return Math.floor(e.replace(/\s/g,"").length/2);default:throw new TypeError("Unknown encoding: "+t)}}});W.prototype.from=W.from;W.prototype.toString=function(e="utf8",t=0,r=this.length){if(typeof e!="string")throw new TypeError("Encoding must be a string");if(typeof t!="number"||!Number.isInteger(t)||t<0)throw new TypeError("Start must be a non-negative integer");if(typeof r!="number"||!Number.isInteger(r)||r<t)throw new TypeError("End must be an integer >= start");try{return L.prototype.toString.call(this,e,t,r)}catch(n){throw new Error("Failed to convert buffer to string: "+n.message)}};var R=W;var De=typeof document>"u",Se=De?(await import("node:crypto")).webcrypto:globalThis.crypto,O=Se.subtle,ie=e=>typeof e=="string"?e:JSON.stringify(e),V=e=>{try{return JSON.parse(e)}catch{return e}},oe=e=>{let t=new Uint8Array(R.alloc(e));return R.from(Se.getRandomValues(t))},ee=(e,t)=>{let[r,n]=e.split(".");return{kty:"EC",crv:"P-256",x:r,y:n,d:t,ext:!0,key_ops:t?["sign"]:["verify"]}},se=async e=>{let t=await O.digest({name:"SHA-256"},new TextEncoder().encode(ie(e)));return R.from(t)},ce=async(e,t)=>{let r=e+t.toString("utf8"),n=R.from(await se(r),"binary"),i=Pe(n);return await O.importKey("jwk",i,{name:"AES-GCM"},!1,["encrypt","decrypt"])},Pe=e=>({kty:"oct",k:e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"});var Je={pair:async e=>{let t=await O.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async i=>{let u=await O.exportKey("jwk",i.publicKey);return{priv:(await O.exportKey("jwk",i.privateKey)).d,pub:u.x+"."+u.y}}),r=await O.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async i=>{let u=await O.exportKey("jwk",i.publicKey);return{epriv:(await O.exportKey("jwk",i.privateKey)).d,epub:u.x+"."+u.y}}),n={pub:t.pub,priv:t.priv,epub:r.epub,epriv:r.epriv};return e&&e(n),n},encrypt:async(e,t,r)=>{if(!t||!t.epriv)return r&&r(null),null;let n={s:oe(9),iv:oe(15)},i=await ce(t.epriv,n.s).then(l=>O.encrypt({name:"AES-GCM",iv:new Uint8Array(n.iv)},l,new TextEncoder().encode(ie(e)))),u={ct:R.from(i,"binary").toString("base64"),iv:n.iv.toString("base64"),s:n.s.toString("base64")};return r&&r(u),u},decrypt:async(e,t,r)=>{if(!e||!e.ct||!e.iv||!e.s||!t||!t.epriv)return r&&r(null),null;let n={ct:R.from(e.ct,"base64"),iv:R.from(e.iv,"base64"),s:R.from(e.s,"base64")};try{let i=await ce(t.epriv,n.s).then(l=>O.decrypt({name:"AES-GCM",iv:new Uint8Array(n.iv),tagLength:128},l,new Uint8Array(n.ct))),u=V(new TextDecoder("utf8").decode(i));return r&&r(u),u}catch{return r&&r(null),null}},verify:async(e,t,r)=>{if(!t||!t.pub)return r&&r(null),null;let n=V(e),i=await O.importKey("jwk",ee(t.pub),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),u={};if(typeof n.m=="string")u=n.m;else for(let s of Object.keys(n.m).sort())s!=="_"&&s!=F&&s!=P&&(u[s]=n.m[s]);let l=await se(u),f=new Uint8Array(R.from(n.s,"base64")),o={name:"ECDSA",hash:{name:"SHA-256"}};if(await O.verify(o,i,f,new Uint8Array(l))){let s=V(n.m);return r&&r(s),s}return r&&r(null),null},sign:async(e,t,r)=>{if(!t||!t.pub||!t.priv)return r&&r(null),null;let n={};if(typeof e=="string")n=e;else{let s=V(e);for(let d of Object.keys(s).sort())d!=="_"&&d!=F&&d!=P&&(n[d]=s[d])}let i=await se(n),u=ee(t.pub,t.priv),l={name:"ECDSA",namedCurve:"P-256"},f=await O.importKey("jwk",u,l,!1,["sign"]).then(s=>O.sign({name:"ECDSA",hash:{name:"SHA-256"}},s,new Uint8Array(i))),o={m:n,s:R.from(f,"binary").toString("base64")};return r&&r(o),o},work:async(e,t,r)=>{typeof t=="function"&&(r=t,t=void 0),typeof t>"u"&&(t=oe(9));let n=await O.importKey("raw",new TextEncoder().encode(ie(e)),{name:"PBKDF2"},!1,["deriveBits"]),i={name:"PBKDF2",iterations:1e5,salt:new TextEncoder().encode(t),hash:{name:"SHA-256"}},u=await O.deriveBits(i,n,512),l={epriv:R.from(u,"binary").toString("base64")};return r&&r(l),l},secret:async(e,t,r)=>{if(!e||!e.epub||!t||!t.epub||!t.epriv)return r&&r(null),null;let n={name:"ECDH",namedCurve:"P-256"},i=ee(e.epub),u=await O.importKey("jwk",i,n,!0,[]),l=ee(t.epub,t.epriv,!1);delete l.key_ops;let f=await O.importKey("jwk",l,n,!1,["deriveBits"]).then(async o=>{let s=await O.deriveBits({public:u,name:"ECDH",namedCurve:"P-256"},o,256),d=await O.importKey("raw",new Uint8Array(s),{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return O.exportKey("jwk",d).then(({k:w})=>w)});return r&&r({epriv:f}),{epriv:f}}},B=Je;var ve=100,He=1e4,pe=(e,t,r,n)=>e<t?{historical:!0}:e>t?{incoming:!0}:(typeof r!="string"&&(r=JSON.stringify(r)||""),typeof n!="string"&&(n=JSON.stringify(n)||""),r===n?{state:!0}:r<n?{current:!0}:{incoming:!0});pe.mix=async(e,t,r,n)=>{if(!e||typeof e!="object")throw new TypeError("change must be an object");if(!t||typeof t!="object")throw new TypeError("graph must be an object");if(!n||typeof n!="object")throw new TypeError("listen must be an object");let i=Date.now(),u={},l={},f=0;for(let s of Object.keys(e)){let d=e[s],w=!1,b=!1,c=0,h=r;if(!d||!d._)continue;let g=d[P],y=d[F];if(g&&y&&(h=!0),s.length>1&&s[0]==="~")if(s[1]==="@")b=!0,h=!1;else{if(y&&s!="~"+y){console.log(`error public key does not match for soul: ${s}`);continue}h=!0}if(!(h&&(!g||!y||!await B.verify({m:d,s:g},{pub:y})))){for(let a of Object.keys(d)){if(a==="_")continue;let p=d[a],S=d._&&d._[">"]?d._[">"][a]:0,m=(t[s]||{})[a],v=(t[s]||{_:{">":{}}})._[">"][a]||0;if(b&&a!==N.is(p)){console.log(`error alias ${b}: ${a} !== ${N.is(p)}`);continue}let k=S-i;if(k>0){if(k>864e5)continue;(f===0||k<f)&&(f=c=k),l[s]||(l[s]={_:{"#":s,">":{}}}),l[s][a]=p,l[s]._[">"][a]=S}else pe(S,v,p,m).incoming&&(u[s]||(u[s]={_:{"#":s,">":{}}}),t[s]||(t[s]={_:{"#":s,">":{}}}),t[s][a]=u[s][a]=p,t[s]._[">"][a]=u[s]._[">"][a]=S,n[s]&&setTimeout(()=>{n[s]&&n[s].filter(E=>z(E["."],a)).forEach(E=>E.cb())},ve),w=!0)}h&&c!==0&&u[s]&&(Object.assign(l[s],u[s]),delete u[s]),w&&n[s]&&setTimeout(()=>{n[s]&&n[s].filter(a=>z(a["."])).forEach(a=>a.cb())},ve)}}let o=Object.keys(t);return o.length>He&&o.map(w=>{let b=t[w]._&&t[w]._[">"],c=b?Math.max(...Object.values(b)):0;return{soul:w,maxState:c}}).sort((w,b)=>w.maxState-b.maxState).slice(0,o.length-maxSize).forEach(({soul:w})=>delete t[w]),{now:u,defer:l,wait:f}};var ge=pe;var K="",Y="",ke=()=>{let e=(t,r,n)=>{if(n||(e[K]||(e[K]={}),n=e[K]),!t)return n;let i=0,u={},l=t[i],f=t.length-1,o=typeof r>"u",s=n[l];for(;!s&&i<f;)l+=t[++i],s=n[l];if(s)if(i===f){if(o)return typeof s[Y]>"u"?s[K]:s[Y];s[Y]=r}else return!s[K]&&!o&&(s[K]={}),e(t.slice(++i),r,s[K]);else if(C.map(n,(w,b)=>{let c=0,h="";for(;b[c]===t[c];)h+=b[c++];if(h){if(o)return c<=f?void 0:(u[b.slice(c)]=w,w);let g={[b.slice(c)]:w,[t.slice(c)]:{[Y]:r}};return n[h]={[K]:g},delete n[b],!0}})){if(o)return u}else{if(o)return;n[l]||(n[l]={}),n[l][Y]=r}};return e};ke.map=function e(t,r,n,i){i||(i=[]);var u=t[K]||t,l=Object.keys(u).sort(),f;for(let o=0;o<l.length;o++){let s=l[o],d=u[s],w=d[Y];if(typeof w<"u"){if(w=r(w,i.join("")+s,s,i),typeof w<"u")return w}else n&&r(f,i.join(""),s,i);if(d[K]){if(i.push(s),w=e(d[K],r,n,i),typeof w<"u")return w;i.pop()}}};var D=ke;var Te="",Ee="",M="",Z=e=>{var t,r=null;if(e||(e={}),e.log||(e.log=console.log),e.batch||(e.batch=10*1e3),e.write||(e.write=1),e.size||(e.size=1024*1024),!e.store){e.log("Radisk needs `store` interface with `{get: fn, put: fn, list: fn}`");return}if(!e.store.get){e.log("Radisk needs `store.get` interface with `(file, cb)`");return}if(!e.store.put){e.log("Radisk needs `store.put` interface with `(file, data, cb)`");return}if(!e.store.list){e.log("Radisk needs a streaming `store.list` interface with `(cb)`");return}let n=(i,u,l)=>{if(i=""+i,typeof u=="function")return l=u,u=n.batch(i),typeof u<"u"||n.thrash.at&&(u=n.thrash.at(i),typeof u<"u")?l(t,u):n.read(i,l);if(n.batch(i,u),l&&n.batch.acks.push(l),++n.batch.ed>=e.batch)return n.thrash();clearTimeout(n.batch.timeout),n.batch.timeout=setTimeout(n.thrash,e.write)};return n.batch=D(),n.batch.acks=[],n.batch.ed=0,n.thrash=()=>{if(n.thrash.ing)return n.thrash.more=!0;clearTimeout(n.batch.timeout),n.thrash.more=!1,n.thrash.ing=!0;var i=n.thrash.at=n.batch;n.batch=null,n.batch=D(),n.batch.acks=[],n.batch.ed=0;let u=0;n.save(i,l=>{++u>1||(l&&e.log(l),i.acks.forEach(f=>f(l)),n.thrash.at=null,n.thrash.ing=!1,n.thrash.more&&n.thrash())})},n.save=(i,u)=>{let l={find:(f,o)=>{if(!(o<l.start))return l.start=o,e.store.list(l.lex),!0},lex:f=>{!f||f>l.start?(l.end=f,l.start&&l.mix(l.file||"!",l.start,l.end)):l.file=f},mix:(f,o,s)=>{l.start=l.end=l.file=t,n.parse(f,(d,w)=>{if(d)return u(d);D.map(i,(b,c)=>{if(!(c<o)){if(s&&s<c){l.start=c;return}w(c,b)}}),n.write(f,w,l.next)})},next:f=>{if(f)return u(f);if(l.start)return D.map(i,l.find);u(f)}};D.map(i,l.find)},n.write=(i,u,l)=>{r=null;let f={text:"",limit:"",done:!1,count:0,each:(o,s,d,w)=>{if(f.done)return;f.count++,o=typeof o>"u"?"":"="+Z.encode(o);let b=Z.encode(w.length)+"#"+Z.encode(d)+o+`
`;if(f.count>1&&w.length===0&&f.text.length+b.length>e.size){let c=d.indexOf(Ee);if(f.limit=c===-1?d:d.substring(0,c),f.limit!==i){f.done=!0,f.sub=D(),D.map(u,f.slice),n.write(f.limit,f.sub,l);return}}f.text+=b},slice:(o,s)=>{s<f.limit||f.sub(s,o)}};D.map(u,f.each,!0),e.store.put(i,f.text,l)},n.read=(i,u)=>{if(r){let s=r(i);if(typeof s<"u")return u(t,s)}let l=i.indexOf(Ee),f=l===-1?i:i.substring(0,l),o={lex:s=>{if(!s){if(!o.file){u("no file found",t);return}n.parse(o.file,o.it);return}s>f||s<o.file||(o.file=s)},it:(s,d)=>{s&&e.log(s),d&&(r=d,o.value=d(i)),u(s,o.value)}};e.store.list(o.lex)},n.parse=(i,u)=>{let l={disk:D(),read:(f,o)=>{if(f)return u(f);if(!o)return u(t,l.disk);let s=[],d=l.split(o);for(;d;){let w,b,c=d[1];d=l.split(d[2])||"",d[0]==="#"&&(w=d[1],s=s.slice(0,c),c<=s.length&&s.push(w)),d=l.split(d[2])||"",d[0]!==`
`&&(d[0]==="="&&(b=d[1]),typeof w<"u"&&typeof b<"u"&&l.disk(s.join(""),b),d=l.split(d[2]))}u(t,l.disk)},split:f=>{if(!f)return;let o=-1,s="",d=null;for(;(d=f[++o])&&d!==M;)s+=d;let w={};if(d)return[s,Z.decode(f.slice(o),w),f.slice(o+w.i)]}};e.store.get(i,l.read)},n};Z.encode=e=>{let t="";if(e instanceof Array&&e.length===2&&(t=Te+e[1],e=e[0]),typeof e=="string"){let n=0,i=null,u=M;for(;i=e[n++];)i===M&&(u+=M);return u+'"'+e+t+M}let r=N.is(e);if(r)return M+"#"+r+t+M;if(te.is(e))return M+"+"+(e||0)+t+M;if(e===!0)return M+"+"+t+M;if(e===!1)return M+"-"+t+M;if(e===null)return M+" "+t+M};Z.decode=(e,t)=>{var r="",n=-1,i=0,u=null,l=null;if(e[0]!==M)return;for(;u=e[++n];)if(l){if(u===M&&--i<=0)break;r+=u}else u===M?i++:l=u||!0;t&&(t.i=n+1);let[f,o]=r.split(Te);if(o){if(o=parseFloat(o),l==='"')return[f,o];if(l==="#")return[N.ify(f),o];if(l==="+")return f.length===0?[!0,o]:[parseFloat(f),o];if(l==="-")return[!1,o];if(l===" ")return[null,o]}else{if(l==='"')return r;if(l==="#")return N.ify(r);if(l==="+")return r.length===0?!0:parseFloat(r);if(l==="-")return!1;if(l===" ")return null}};var je=Z;var $e=typeof document>"u",G=$e?await import("node:fs"):void 0,Ae="",ue="",de=ue+"+0"+ue+"#"+ue+'"root'+ue,qe=e=>{let t=e.file;if($e)return G.existsSync(t)||G.mkdirSync(t),G.existsSync(t+"/!")||G.writeFileSync(t+"/!",de),{get:(r,n)=>{G.readFile(t+"/"+r,(i,u)=>{if(i){if(i.code==="ENOENT"){n();return}console.log("fs.readFile error:",i)}u&&(u=u.toString()),n(i,u)})},put:(r,n,i)=>{var u=r+"."+_.random(9)+".tmp";G.writeFile(u,n,l=>{if(l){console.log("fs.writeFile error:",l),i(l);return}G.rename(u,t+"/"+r,i)})},list:r=>{G.readdir(t,(n,i)=>{if(n){console.log("fs.readdir error:",n),r();return}i.forEach(r),r()})}};if(e.indexedDB){let r,n=indexedDB.open(t,1);return n.onupgradeneeded=i=>{i.target.result.createObjectStore(t)},n.onerror=i=>{console.log(i)},n.onsuccess=()=>{if(r=n.result,r){let u=r.transaction([t],"readonly").objectStore(t).getKey("!");u.onerror=()=>{console.log(`error getting key ${t}/!`)},u.onsuccess=()=>{if(!u.result){let f=r.transaction([t],"readwrite").objectStore(t).put(de,"!");f.onerror=()=>{console.log(`error putting root on ${t}/!`)}}}}else console.log("error indexedDB not available")},{get:(i,u)=>{let l=(s,d)=>{let b=r.transaction([t],"readonly").objectStore(t).get(s);b.onerror=()=>{console.log(`error getting ${t}/${s}`)},b.onsuccess=()=>{d(null,b.result)}};if(r){l(i,u);return}let f=0,o=setInterval(()=>{if(r){clearInterval(o),l(i,u);return}f++>5&&(clearInterval(o),u("error indexedDB not available"))},1e3)},put:(i,u,l)=>{let f=(d,w,b)=>{let h=r.transaction([t],"readwrite").objectStore(t).put(w,d);h.onerror=()=>{console.log(`error putting data on ${t}/${d}`)},h.onsuccess=()=>{b(null)}};if(r){f(i,u,l);return}let o=0,s=setInterval(()=>{if(r){clearInterval(s),f(i,u,l);return}o++>5&&(clearInterval(s),l("error indexedDB not available"))},1e3)},list:i=>{let u=o=>{let d=r.transaction([t],"readonly").objectStore(t).getAllKeys();d.onerror=()=>console.log("error getting keys for",t),d.onsuccess=()=>{d.result.forEach(o),o()}};if(r){u(i);return}let l=0,f=setInterval(()=>{if(r){clearInterval(f),u(i);return}l++>5&&(clearInterval(f),console.log("error indexedDB not available"),i())},1e3)}}}return{get:(r,n)=>{n(null,de)},put:(r,n,i)=>{i(null)},list:r=>{r("!"),r()}}},Le=e=>{C.is(e)||(e={}),e.file=String(e.file||"radata"),e.store||(e.store=qe(e));let t=je(e);return{get:(r,n)=>{if(!r||!C.is(r)){n("lex required");return}if(!r["#"]){n("soul required in lex");return}var i=r["#"],u=typeof r["."]=="string"?r["."]:"",l;let f=(o,s)=>{z(r["."],s)&&(l||(l={_:{"#":i,">":{}}}),l[s]=o[0],l._[">"][s]=o[1])};t(i+Ae+u,(o,s)=>{let d;C.is(s)?(D.map(s,f),l||f(s,u),d={[i]:l}):s&&(f(s,u),d={[i]:l}),n(o,d)})},put:(r,n)=>{if(!r){n("graph required");return}let i=0,u=!1,l=f=>{if(i--,!u){if(f){u=!0,n(f);return}i===0&&(u=!0,n(null))}};Object.keys(r).forEach(f=>{var o=r[f];Object.keys(o).forEach(s=>{if(s==="_")return;i++;let d=o[s],w=o._[">"][s];t(f+Ae+s,[d,w],l)})})}}},xe=Le;var _e=typeof document>"u",Oe=_e?await import("ws"):void 0;typeof globalThis.WebSocket>"u"&&(globalThis.WebSocket=Oe?.WebSocket);var We=e=>{let t=new Map,r=e.maxRequestsPerMinute||100,n=e.rateLimitWindow||6e4,i=e.wss&&e.wss.constructor.name==="Server",u=null;return i||(u=setInterval(()=>{let f=Date.now();for(let[o,s]of t.entries())f-s.lastCleanup>n&&(s.requests=[],s.lastCleanup=f),s.requests=s.requests.filter(d=>f-d<n)},n/4)),{getDelay:f=>{let o=Date.now(),s=t.get(f)||{requests:[],lastCleanup:o};if(s.requests=s.requests.filter(d=>o-d<n),s.requests.length>=r){let d=Math.min(...s.requests),w=n-(o-d);return Math.max(0,w)}return s.requests.push(o),t.set(f,s),0},getRemainingRequests:f=>{let o=t.get(f);if(!o)return r;let s=Date.now(),d=o.requests.filter(w=>s-w<n);return Math.max(0,r-d.length)},destroy:()=>{u&&(clearInterval(u),u=null),t.clear()}}},Ge=(e,t=1024*1024)=>{try{if(typeof e=="string"&&e.length>t)throw new Error("Message too large");return{success:!0,data:JSON.parse(e)}}catch(r){return{success:!1,error:r.message}}},ze=(e,t=1024*1024)=>typeof e=="string"&&e.length>t?{valid:!1,error:"Message too large"}:Buffer.isBuffer(e)&&e.length>t?{valid:!1,error:"Message too large"}:{valid:!0},Xe=(e=1e3)=>{let t=new Set;return{add:r=>{if(t.size>=e)return!1;t.add(r);let n=r.close;return r.close=(...i)=>(t.delete(r),n.apply(r,i)),!0},remove:r=>{t.delete(r)},count:()=>t.size,isFull:()=>t.size>=e}},ye=(e=5)=>{let t=0;return{shouldRetry:()=>t<e,getDelay:()=>Math.min(1e3*Math.pow(2,t),3e4),increment:()=>t++,reset:()=>t=0}},Ze=e=>{let t=me(e.maxAge),r=xe(e),n={},i={},u={},l=We(e),f=Xe(e.maxConnections||1e3),o=async(g,y,a)=>{for(let p of Object.keys(g)){let S=await new Promise(k=>{w({"#":p},k,y)});if(S.err)return a&&a(S.err),!1;let m=g[p],v=F;if(!(!S.put||!S.put[p]||S.put[p][v]===m[v]))return a&&a(`error in wire check public key does not match for soul: ${p}`),!1}return!0},s=(g,y)=>{let a=fe(g.get,n);a?y(JSON.stringify({"#":t.track(_.random(9)),"@":g["#"],put:a})):r.get(g.get,(p,S)=>{y(JSON.stringify({"#":t.track(_.random(9)),"@":g["#"],put:S,err:p}))})},d=async(g,y)=>{let a=await ge.mix(g.put,n,e.secure,u);if(Object.keys(a.now).length){if(!await o(a.now,y))return;r.put(a.now,p=>{y(JSON.stringify({"#":t.track(_.random(9)),"@":g["#"],err:p}))})}Object.keys(a.defer).length&&setTimeout(()=>d({put:a.defer},y),a.wait)},w=(g,y,a,p)=>{if(!y)return;C.is(p)||(p={});let S=fe(g,n),m=_.random(9),v=JSON.stringify({"#":t.track(m),get:e.secure?{"#":g["#"]}:g});if(S){a(v),y({put:S});return}r.get(g,(k,j)=>{if(j){a(v),y({put:j,err:k});return}k&&console.log(k),i[m]=y,a(v),setTimeout(()=>{let E=i[m];if(E){let A=g["#"],$={[A]:null};typeof g["."]=="string"&&($[A]={[g["."]]:null}),E({put:$}),delete i[m]}},p.wait||100)})},b=g=>({get:(y,a,p)=>{w(y,a,g,p)},put:async(y,a)=>{let p=await ge.mix(y,n,e.secure,u);if(Object.keys(p.now).length===0){a(null);return}await o(p.now,g,a)&&(r.put(p.now,a),g(JSON.stringify({"#":t.track(_.random(9)),put:y})))},on:(y,a,p,S)=>{let m=y&&y["#"];!m||!a||(u[m]?u[m].push({".":y["."],cb:a}):u[m]=[{".":y["."],cb:a}],p&&w(y,a,g,S))},off:(y,a)=>{let p=y&&y["#"];if(!(!p||!u[p]))if(a){let S=u[p].find(m=>m.cb===a);S&&u[p].splice(u[p].indexOf(S),1)}else delete u[p]}});if(_e){let g=e.wss,y=()=>g.clients();if(!g){let p=e.server?{server:e.server}:{port:e.port||8765};g=new Oe.WebSocketServer(p),y=()=>g.clients}let a=(p,S)=>{y().forEach(m=>{if(m&&m.readyState===WebSocket.OPEN)m.send(p,{binary:S});else{let v=m._retryHandler||ye();if(m._retryHandler=v,v.shouldRetry()){let k=v.getDelay();v.increment(),setTimeout(()=>{m&&m.readyState===WebSocket.OPEN&&(v.reset(),m.send(p,{binary:S}))},k)}}})};return g.on("connection",p=>{if(!f.add(p)){console.log("Connection limit reached, rejecting connection"),p.close(1013,"Connection limit reached - try again later");return}let S=_.random(9);p.on("error",m=>{console.error("WebSocket error:",m),f.remove(p)}),p.on("close",()=>{f.remove(p)}),p.on("message",(m,v)=>{let k=ze(m,e.maxMessageSize);if(!k.valid){console.warn(`Invalid message: ${k.error}`),p.send(JSON.stringify({error:k.error}));return}let j=Ge(m,e.maxMessageSize);if(!j.success){console.warn(`JSON parse error: ${j.error}`),p.send(JSON.stringify({error:"Invalid JSON"}));return}let E=j.data;if(t.check(E["#"]))return;let A=l.getDelay(S),$=()=>{t.track(E["#"]),E.get&&s(E,a),E.put&&d(E,a),a(m,v);let x=E["@"],T=i[x];T&&(delete E["#"],delete E["@"],T(E),delete i[x])};A>0?setTimeout($,A):$()})}),b(a)}let c=[],h=g=>{c.forEach(y=>{if(y&&y.readyState===WebSocket.OPEN)y.send(g);else{let a=y._retryHandler||ye();if(y._retryHandler=a,a.shouldRetry()){let p=a.getDelay();a.increment(),setTimeout(()=>{y&&y.readyState===WebSocket.OPEN&&(a.reset(),y.send(g))},p)}}})};return e.peers instanceof Array||(e.peers=[`ws://localhost:${e.port||8765}`]),e.peers.forEach(g=>{let y=()=>{let a=new WebSocket(g);c.push(a);let p=ye();a.onclose=S=>{if(c.indexOf(a)!==-1&&c.splice(c.indexOf(a),1),a=null,p.shouldRetry()){let m=p.getDelay();p.increment(),setTimeout(y,m)}},a.onopen=()=>{p.reset()},a.onerror=S=>{console.error(S)},a.onmessage=S=>{let m=JSON.parse(S.data);if(t.check(m["#"]))return;t.track(m["#"]),m.get&&s(m,h),m.put&&d(m,h),h(S.data);let v=m["@"],k=i[v];k&&(delete m["#"],delete m["@"],k(m),delete i[v])}};y()}),b(h)},le=Ze;var Ye=(e,t)=>{t||(t=le(e));let r=[],n=!1,i=!1,u=0,l=(o,s,d,w)=>{let b=y=>{u++,l(y,s,d,w)},c=y=>{r=[],u=0,i=!1,w(y)},h=()=>{if(r.length===0){c("Wrong username or password");return}let y=r.shift();t.get({"#":y},async a=>{if(a.err){c(`error getting ${y}: ${a.err}`);return}let p=a.put&&a.put[y];if(!p||!p.auth)return h();let S=JSON.parse(p.auth),m=await B.work(s,S.salt),v=await B.decrypt(S.enc,m);if(!v)return h();if(f.is={username:o,pub:p.pub,epub:p.epub,priv:v.priv,epriv:v.epriv},d!==""){let k=_.random(64),j=await B.work(d,k),E=await B.encrypt(v,j),A={username:o,pub:p.pub,epub:p.epub,auth:JSON.stringify({enc:E,salt:k})},$=await B.sign(A,f.is),x=q(y,$.m,$.s,p.pub);t.put(x,T=>{c(T?`error putting ${A} on ${y}: ${T}`:null)});return}return c(null)},{wait:1e3})};if(u>9){c("Wrong username or password");return}let g="~@"+o;t.get({"#":g},async y=>{if(y.err){c(`error getting ${g}: ${y.err}`);return}let a=y.put&&y.put[g];if(!a)return b(o);delete y.put[g]._,r=Object.keys(a),h()},{wait:1e3})},f={create:(o,s,d)=>{let w=c=>{d?d(c):console.log(c)};if(n){w("User is already being created");return}if(o===""){w("Please provide a username");return}if(s===""){w("Please provide a password");return}n=!0;let b="~@"+o;t.get({"#":b},async c=>{if(c.err){n=!1,w(`error getting ${b}: ${c.err}`);return}if(c.put&&c.put[b]){n=!1,w("Username already exists");return}let h=_.random(64),g=await B.work(s,h),y=await B.pair(),a={priv:y.priv,epriv:y.epriv},p=await B.encrypt(a,g),S={username:o,pub:y.pub,epub:y.epub,auth:JSON.stringify({enc:p,salt:h})},m="~"+y.pub,v=await B.sign(S,y),k=q(m,v.m,v.s,y.pub);t.put(k,j=>{if(n=!1,j){w(`error putting ${S} on ${m}: ${j}`);return}let E={[m]:{"#":m}};t.put(q(b,E),A=>{if(A){w(`error putting ${E} on ${b}: ${A}`);return}d&&d(null)})})},{wait:1e3})},auth:(o,s,d)=>{let w=b=>{d?d(b):b&&console.log(b)};if(i){w("User is already authenticating");return}if(f.is=null,o===""){w("Please provide a username");return}if(s===""){w("Please provide a password");return}i=!0,l(o,s,"",w)},change:(o,s,d,w)=>{let b=c=>{w?w(c):c&&console.log(c)};if(i){b("User is already authenticating");return}if(f.is=null,o===""){b("Please provide a username");return}if(s===""){b("Please provide a password");return}if(d===""){b("Please provide a new password");return}i=!0,l(o,s,d,b)},store:o=>{if(!f.is){console.log("Please authenticate before calling store");return}if(o){typeof globalThis.localStorage<"u"&&globalThis.localStorage.setItem("user.is",JSON.stringify(f.is)),typeof globalThis.sessionStorage<"u"&&globalThis.sessionStorage.removeItem("user.is");return}typeof globalThis.sessionStorage<"u"&&globalThis.sessionStorage.setItem("user.is",JSON.stringify(f.is)),typeof globalThis.localStorage<"u"&&globalThis.localStorage.removeItem("user.is")},recall:()=>{if(typeof globalThis.localStorage<"u"){let o=globalThis.localStorage.getItem("user.is");if(o){f.is=JSON.parse(o);return}}if(typeof globalThis.sessionStorage<"u"){let o=globalThis.sessionStorage.getItem("user.is");o&&(f.is=JSON.parse(o))}},leave:()=>{f.is=null,typeof globalThis.localStorage<"u"&&globalThis.localStorage.removeItem("user.is"),typeof globalThis.sessionStorage<"u"&&globalThis.sessionStorage.removeItem("user.is")},delete:(o,s,d)=>{let w=b=>{d?d(b):console.log(b)};if(i){w("User is already authenticating");return}if(o===""){w("Please provide a username");return}if(s===""){w("Please provide a password");return}i=!0,l(o,s,"",async b=>{if(b){w(b);return}let c={username:null,pub:null,epub:null,auth:null},h=await B.sign(c,f.is),g="~"+f.is.pub,y=q(g,h.m,h.s,f.is.pub);t.put(y,a=>{if(a){w(`error putting null on ${g}: ${a}`);return}f.is=null,d&&d(null)})})}};return f},Ce=Ye;var Qe=e=>{typeof e=="string"?e={peers:[e]}:e instanceof Array?e={peers:e}:C.is(e)||(e={});let t=le(e),r=Ce(null,t),n=new Map,i=new Map,u=o=>o===null||o===!0||o===!1||typeof o=="string"||N.is(o)||te.is(o),l=o=>{if(u(o))return!0;if(C.is(o)){let d=[];for(let[w,b]of Object.entries(o)){if(w==="_")return"error underscore cannot be used as a property name";if(C.is(b)||u(b)){d.push(w);continue}return typeof b>"u"?`error undefined ${w} cannot be converted to a graph`:`error ${JSON.stringify({[w]:b})} cannot be converted to a graph`}if(d.length!==0)return d}return`error ${JSON.stringify(o)} cannot be converted to a graph`},f=o=>{let s=(c,h,g,y)=>{t.get(C.put(c,"#",h),async a=>{if(a.err&&console.log(a.err),a.put&&a.put[h]){delete a.put[h]._,delete a.put[h][F],delete a.put[h][P];for(let p of Object.keys(a.put[h])){let S=N.is(a.put[h][p]);if(S){let m=await new Promise(v=>{let k=_.random();i.set(k,{chain:[{item:null,soul:S}]}),f(k).next(null,v,y)});a.put[h][p]=m}}g(a.put[h])}else g(null)},y)},d=async(c,h,g,y)=>{if(g){let a=await B.sign(h,g);return q(c,a.m,a.s,g.pub)}return e.secure?(y||(y=console.log),y(`error putting data on ${c}: user required in secure mode`),null):q(c,h)},w=c=>h=>{let g=i.get(c);g&&typeof g.cb<"u"?setTimeout(()=>g.cb(h),1):h&&console.log("error no callback for data",h,"ctx",g),g&&!g.on&&i.delete(c)},b=(c,h)=>{if(!c){console.log("error resolve request parameter required");return}let g=typeof c.get<"u",y=typeof c.put<"u",a=typeof c.on<"u",p=typeof c.off<"u",S=!1,m=i.get(o);for(var v=1;v<m.chain.length;v++)if(m.chain[v].soul===null){S=!0;break}if(S){let{item:k,soul:j}=m.chain[v-1],E=m.user||e.secure?{"#":j}:{"#":j,".":k};return t.get(E,async A=>{if(A.err){m.user||e.secure?console.log(`error getting ${j}: ${A.err}`):console.log(`error getting ${k} on ${j}: ${A.err}`),h&&h(null);return}let $=A.put&&A.put[j];if($&&typeof $[k]<"u"){let x=N.is($[k]);if(x)m.chain[v].soul=x,i.set(o,{...m}),g?f(o).next(null,c.get,h,c._opt):y?f(o).put(c.put,h):a?f(o).on(c.on,h,c._get,c._opt):p&&f(o).off(h);else if(g)h($[k]);else if(y){x=_.random(),$[k]=N.ify(x);let T=await d(j,$,m.user,h);if(T===null)return;t.put(T,I=>{if(I){h(`error putting ${k} on ${j}: ${I}`);return}m.chain[v].soul=x,f(o).put(c.put,h)})}else(a||p&&h)&&h(null)}else if(y){let x=_.random();$||($={}),$[k]=N.ify(x);let T=await d(j,$,m.user,h);if(T===null)return;t.put(T,I=>{if(I){h(`error putting ${k} on ${j}: ${I}`);return}m.chain[v].soul=x,f(o).put(c.put,h)})}else h&&h(null)},c._opt),!1}return g&&m.chain[m.chain.length-1].item!==null?(m.chain.push({item:null,soul:null}),f(o).next(null,c.get,h,c._opt),!1):m.chain[m.chain.length-1]};return{get:(c,h,g,y)=>{if(typeof h=="function"&&(y=g,g=h,h=null),c===null||c===""||c==="_"){console.log("error please provide a key"),g&&g(null);return}if(h&&typeof g!="function"){console.log("error lex requires a callback function");return}if(o=_.random(),i.set(o,{chain:[{item:c,soul:"root"}],cb:g}),!g)return f(o);let a=w(o),{soul:p}=b({get:h,_opt:y},a);p&&s(h,p,a,y)},next:(c,h,g,y)=>{let a=v=>k=>{g?g(k):w(v)(k)};if(typeof h=="function"&&(y=g,g=h,h=null),!o){console.log("error please provide a key using get(key)"),g&&g(null);return}let p=a(o);if(c===""||c==="_"){p(null);return}if(h&&typeof g!="function"){console.log("error lex requires a callback function");return}let S=i.get(o);if(!S)return;if(g&&typeof S.cb>"u"&&(S.cb=g,g=null),c!==null&&S.chain.push({item:c,soul:null}),!S.cb)return f(o);let{soul:m}=b({get:h,_opt:y},p);m&&s(h,m,p,y)},put:(c,h,g)=>{typeof h=="function"&&(g=h,h=!1);let y=j=>E=>{g?g(E):w(j)(E)};if(!o){g&&g("error please provide a key using get(key)");return}let a=i.get(o);if(!a)return;if(!a.cb){if(!g)return;a.cb=g,g=null}h&&(c={[_.random()]:c});let p=y(o),S=l(c);if(typeof S=="string"){p(S);return}let{item:m,soul:v}=b({put:c},p);if(!v)return;if(S===!0){let j=a.user||e.secure?{"#":v}:{"#":v,".":m};t.get(j,async E=>{if(E.err){p(`error getting ${v}: ${E.err}`);return}let A=E.put&&E.put[v],$=A&&A[m],x=N.is($);if(!x){A||(A={}),A[m]=c;let T=await d(v,A,a.user,p);if(T===null)return;t.put(T,p);return}t.get({"#":x},async T=>{if(T.err){p(`error getting ${x}: ${T.err}`);return}if(!T.put||!T.put[x]){p(`error ${x} not found`);return}for(let U of Object.keys(T.put[x])){if(U==="_"||U===F||U===P)continue;let J=await new Promise(ae=>{let he=_.random(),Ie=[{item:U,soul:x}];i.set(he,{chain:Ie,user:a.user}),f(he).put(null,ae)});if(J){p(J);return}}A||(A={}),A[m]=c;let I=await d(v,A,a.user,p);I!==null&&t.put(I,p)})});return}let k=a.user||e.secure?{"#":v}:{"#":v,".":m};t.get(k,async j=>{if(j.err){p(`error getting ${v}.${m}: ${j.err}`);return}let E=j.put&&j.put[v],A=E&&E[m],$=N.is(A);if(!$){E||(E={}),E[m]=N.ify(_.random());let T=await d(v,E,a.user,p);if(T===null)return;t.put(T,I=>{if(I)p(`error putting ${m} on ${v}: ${I}`);else{let U=_.random(),J=[{item:m,soul:v}];i.set(U,{chain:J,user:a.user,cb:a.cb}),f(U).put(c)}});return}let x=[];for(let T of S){let I=await new Promise(U=>{if(C.is(c[T])&&!N.is(c[T])){let J=_.random(),ae=[{item:T,soul:$}];i.set(J,{chain:ae,user:a.user}),f(J).put(c[T],U)}else x.push(T),U(null)});if(I){p(I,o);return}}if(x.length===0){p(null);return}t.get({"#":$},async T=>{if(T.err){p(`error getting ${$}: ${T.err}`);return}let I=T.put&&T.put[$];I||(I={}),x.forEach(J=>{I[J]=c[J]});let U=await d($,I,a.user,p);U!==null&&t.put(U,p)})})},on:(c,h,g,y)=>{if(typeof c=="function"&&(y=g,g=h,h=c,c=null),typeof h!="function"){console.log("error on() requires a callback function");return}if(!o){console.log("error please provide a key using get(key)"),h(null);return}let{item:a,soul:p}=b({on:c,_get:g,_opt:y},h);p&&(i.set(o,{chain:[{item:a,soul:p}],on:!0}),n.set(h,()=>f(o).next(null,h,y)),t.get({"#":p,".":a},S=>{if(S.err){console.log(`error getting ${p}.${a}: ${S.err}`);return}let m=S.put&&S.put[p]&&S.put[p][a],v=N.is(m);v?c?c=C.put(c,"#",v):c={"#":v,".":null}:c?c=C.put(c,"#",p):c={"#":p,".":a},t.on(c,n.get(h),g,y)},y))},off:c=>{if(!o){console.log("error please provide a key using get(key)"),c&&c(null);return}let{item:h,soul:g}=b({off:!0},c);g&&t.get({"#":g,".":h},y=>{if(y.err){console.log(`error getting ${g}.${h}: ${y.err}`);return}let a=y.put&&y.put[g]&&y.put[g][h],p=N.is(a);p?t.off({"#":p},n.get(c)):t.off({"#":g},n.get(c)),n.delete(c),i.delete(o)})},user:()=>(r.get||(Object.assign(r,f()),r.get=(c,h,g,y)=>{typeof h=="function"&&(y=g,g=h,h=null);let a=null,p=null;if(r.is&&(a=r.is.pub),typeof c=="string"?p=c:c instanceof Array&&(c.length===2?(a=c[0],p=c[1]):c.length===1&&(p=c[0])),!a){console.log("error please log in or provide a public key"),g&&g(null);return}if(p===null||p===""||p==="_"){console.log("error please provide a key"),g&&g(null);return}if(h&&!g){console.log("error lex requires a callback function");return}o=_.random();let S=[{item:p,soul:"~"+a}];if(i.set(o,{chain:S,user:r.is,cb:g}),!g)return f(o);let m=w(o),{soul:v}=b({get:h,_opt:y},m);v&&s(h,v,m,y)}),r),wire:t,SEA:B}};return f()},xt=Qe;export{xt as default};
//# sourceMappingURL=holster.js.map
