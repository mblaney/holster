(()=>{var e={127:e=>{var t,r=Object.defineProperty,o=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};((e,t)=>{for(var o in t)r(e,o,{get:t[o],enumerable:!0})})(s,{isBrowser:()=>l,isBun:()=>d,isDeno:()=>f,isJsDom:()=>a,isNode:()=>u,isWebWorker:()=>c}),e.exports=(t=s,((e,t,s,l)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of n(t))i.call(e,s)||undefined===s||r(e,s,{get:()=>t[s],enumerable:!(l=o(t,s))||l.enumerable});return e})(r({},"__esModule",{value:!0}),t));var l="undefined"!=typeof window&&void 0!==window.document,u="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,c="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,a="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&"userAgent"in navigator&&"string"==typeof navigator.userAgent&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),f="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,d="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.bun},591:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},45:e=>{e.exports=e=>{e||(e=9e3);const t={store:{},check:e=>!!t.store[e]&&t.track(e),track:r=>(t.store[r]=Date.now(),t.expiry||(t.expiry=setTimeout((()=>{const r=Date.now();Object.keys(t.store).forEach((o=>{r-t.store[o]>e&&delete t.store[o]})),t.expiry=null}),e)),r)};return t}},664:e=>{e.exports=(e,t)=>{const r=e["#"],o=e["."];var n=t[r];if(!n||!o)return;let i=n[o];return i?((n={_:n._,[o]:i})._[">"]={[o]:n._[">"][o]},{[r]:n}):void 0}},626:e=>{const t=(e,t,r,o)=>e<t?{historical:!0}:e>t?{incoming:!0}:("string"!=typeof r&&(r=JSON.stringify(r)||""),"string"!=typeof o&&(o=JSON.stringify(o)||""),r===o?{state:!0}:r<o?{current:!0}:{incoming:!0});t.mix=(e,r)=>{var o=Date.now(),n={},i={};let s=0;return Object.keys(e).forEach((l=>{const u=e[l];Object.keys(u).forEach((e=>{if("_"===e)return;const c=u[e],a=u._[">"][e],f=(r[l]||{})[e],d=(r[l]||{_:{">":{}}})._[">"][e]||0,p=a-o;if(p>0){if(p>864e5)return;(0===s||p<s)&&(s=p),i[l]||(i[l]={_:{"#":l,">":{}}}),i[l][e]=c,i[l]._[">"][e]=a}else t(a,d,c,f).incoming&&(n[l]||(n[l]={_:{"#":l,">":{}}}),r[l]||(r[l]={_:{"#":l,">":{}}}),r[l][e]=n[l][e]=c,r[l]._[">"][e]=n[l]._[">"][e]=a)}))})),{now:n,defer:i,wait:s}},e.exports=t},299:(e,t,r)=>{const o=r(413),n=r(643);e.exports=e=>{const t=n(e),r=e=>null===e||!0===e||!1===e||"string"==typeof e||o.rel.is(e)||o.num.is(e),i=(e,t,r)=>{r?r[e]={_:{"#":e,">":{}}}:r={[e]:{_:{"#":e,">":{}}}};for(const[o,n]of Object.entries(t))r[e][o]=n,r[e]._[">"][o]=Date.now();return r},s=e=>{s.ctx=e;const n=(e,r)=>{const n=void 0!==e.get;for(let l=1;l<s.ctx.length;l++){if(null!==s.ctx[l].soul)continue;const{item:u,soul:c}=s.ctx[l-1];return t.get({"#":c,".":u},(a=>{if(a.err)return console.log(`error getting ${u} on ${c}: ${a.err}`),void r(null);if(0===s.ctx.length)return;const f=a.put&&a.put[c];if(f&&"undefined"!==f[u]){let a=o.rel.is(f[u]);if(a)s.ctx[l].soul=a,n?s(s.ctx).get(null,e.get,r):s(s.ctx).put(e.put,r);else if(n)r(f[u]);else{a=o.text.random();const n={[u]:o.rel.ify(a)};t.put(i(c,n),(t=>{t?ack(`error putting ${u} on ${c}: ${t}`):(s.ctx[l].soul=a,s(s.ctx).put(e.put,r))}))}}else console.log(`error ${u} not found on ${c}`),r(null)})),!1}return n&&null!==s.ctx[s.ctx.length-1].item?(s.ctx.push({item:null,soul:null}),s(s.ctx).get(null,e.get,r),!1):s.ctx[s.ctx.length-1]},l=e=>{if(s.ctx&&(s.ctx=[]),s.cb){const t=s.cb;return s.cb=null,void t(e)}e&&console.log(e)};return{get:(e,r,i)=>{"function"==typeof r&&(i=r,r=null),i&&!s.cb&&(s.cb=i,i=null);const u=e=>{i?i(e):l(e)};if(""===e||"_"===e)return u(null),s(s.ctx);if(s.ctx&&0!==s.ctx.length)null!==e&&s.ctx.push({item:e,soul:null});else{if(null===e)return u(null),s(s.ctx);s.ctx=[{item:e,soul:"root"}]}if(!s.cb)return s(s.ctx);const{soul:c}=n({get:r},u);return c?(t.get(o.obj.put(r,"#",c),(async e=>{if(e.err&&console.log(e.err),e.put&&e.put[c]){delete e.put[c]._;for(const t of Object.keys(e.put[c])){const r=o.rel.is(e.put[c][t]);if(r){const o=await new Promise((e=>{s([{item:null,soul:r}]).get(null,e)}));e.put[c][t]=o}}u(e.put[c])}else u(null)})),s(s.ctx)):s(s.ctx)},put:(e,u)=>{if(!s.cb){if(!u)return;s.cb=u,u=null}const c=e=>{u?u(e):l(e)};if(!s.ctx||0===s.ctx.length)return void c("please provide a key using get(key) before put");const a=(e=>{if(r(e))return!0;if(o.obj.is(e)){const t=[];for(const[n,i]of Object.entries(e)){if("_"===n)return"error underscore cannot be used as an item name";if(!o.obj.is(i)&&!r(i))return`error {${n}:${i}} cannot be converted to graph`;t.push(n)}if(0!==t.length)return t}return`error ${e} cannot be converted to a graph`})(e);if("string"==typeof a)return void c(a);const{item:f,soul:d}=n({put:e},c);return d?!0===a?(t.get({"#":d,".":f},(async e=>{if(e.err)return void console.log(`error getting ${d}: ${e.err}`);const r=e.put&&e.put[d]&&e.put[d][f],n=o.rel.is(r);n&&t.get({"#":n},(async e=>{if(e.err)console.log(`error getting ${n}: ${e.err}`);else if(e.put&&e.put[n]){delete e.put[n]._;for(const t of Object.keys(e.put[n]))s([{item:t,soul:n}]).put(null,(e=>{null!==e&&console.log(e)}))}else console.log(`error ${n} not found`)}))})),void t.put(i(d,{[f]:e}),c)):void t.get({"#":d,".":f},(async r=>{if(r.err)return void c(`error getting ${d}: ${r.err}`);const n=r.put&&r.put[d]&&r.put[d][f],l=o.rel.is(n);if(!l){const r={[f]:o.rel.ify(o.text.random())};return void t.put(i(d,r),(t=>{t?c(`error putting ${f} on ${d}: ${t}`):s(s.ctx).put(e,c)}))}let u=!1;const p={};for(const t of a){const r=await new Promise((r=>{o.obj.is(e[t])?s([{item:t,soul:l}]).put(e[t],r):(u=!0,p[t]=e[t],r(null))}));if(r)return void c(r)}u?t.put(i(l,p),c):c()})):void 0},wire:t}};return s()}},166:(e,t,r)=>{const o=r(62),n=r(413),i=String.fromCharCode(3),s=String.fromCharCode(5),l=String.fromCharCode(31),u=e=>{var t,r=null;if(e||(e={}),e.log||(e.log=console.log),e.batch||(e.batch=1e4),e.wait||(e.wait=1),e.size||(e.size=1048576),!e.store)return void e.log("Radisk needs `store` interface with `{get: fn, put: fn, list: fn}`");if(!e.store.get)return void e.log("Radisk needs `store.get` interface with `(file, cb)`");if(!e.store.put)return void e.log("Radisk needs `store.put` interface with `(file, data, cb)`");if(!e.store.list)return void e.log("Radisk needs a streaming `store.list` interface with `(cb)`");const n=(r,o,i)=>(r=""+r,"function"==typeof o?(i=o,void 0!==(o=n.batch(r))||n.thrash.at&&void 0!==(o=n.thrash.at(r))?i(t,o):n.read(r,i)):(n.batch(r,o),i&&n.batch.acks.push(i),++n.batch.ed>=e.batch?n.thrash():(clearTimeout(n.batch.timeout),void(n.batch.timeout=setTimeout(n.thrash,e.wait)))));return n.batch=o(),n.batch.acks=[],n.batch.ed=0,n.thrash=()=>{if(n.thrash.ing)return n.thrash.more=!0;clearTimeout(n.batch.timeout),n.thrash.more=!1,n.thrash.ing=!0;var t=n.thrash.at=n.batch;n.batch=null,n.batch=o(),n.batch.acks=[],n.batch.ed=0;let r=0;n.save(t,(o=>{++r>1||(o&&e.log(o),t.acks.forEach((e=>e(o))),n.thrash.at=null,n.thrash.ing=!1,n.thrash.more&&n.thrash())}))},n.save=(r,i)=>{const s={find:(t,r)=>{if(!(r<s.start))return s.start=r,e.store.list(s.lex),!0},lex:e=>{if(!e||e>s.start)return s.end=e,s.mix(s.file||"!",s.start,s.end),!0;s.file=e},mix:(e,l,u)=>{s.start=s.end=s.file=t,n.parse(e,((t,c)=>{if(t)return i(t);o.map(r,((e,t)=>{if(!(t<l))return u&&u<t?(s.start=t,s.start):void c(t,e)})),n.write(e,c,s.next)}))},next:e=>e?i(e):s.start?o.map(r,s.find):void i(e)};o.map(r,s.find)},n.write=(t,i,l)=>{r=null;const c={text:"",count:0,file:t,each:(t,r,n,s)=>{c.count++;var l=u.encode(s.length)+"#"+u.encode(n)+(void 0===t?"":"="+u.encode(t))+"\n";if(c.count>1&&c.text.length+l.length>e.size)return c.text="",c.limit=Math.ceil(c.count/2),c.count=0,c.sub=o(),o.map(i,c.slice),!0;c.text+=l},put:()=>{e.store.put(t,c.text,l)},slice:(e,t)=>{if(!(t<c.file)){if(++c.count>c.limit){var r=c.file;let e=t.indexOf(s);return c.file=-1===e?t:t.substring(0,e),c.sub(c.file,null),c.count=0,n.write(r,c.sub,c.next),!0}c.sub(t,e)}},next:e=>{if(e)return l(e);c.sub=o(),o.map(i,c.slice)||n.write(c.file,c.sub,l)}};o.map(i,c.each,!0)||c.put()},n.read=(o,i)=>{if(r){let e=r(o);if(void 0!==e)return i(t,e)}let l=o,u=o.indexOf(s);-1!==u&&(l=o.substring(0,u));const c={lex:e=>{if(!e)return c.file?void n.parse(c.file,c.it):void i("no file found",t);e>l||e<c.file||(c.file=e)},it:(t,n)=>{t&&e.log(t),n&&(r=n,c.value=n(o)),i(t,c.value)}};e.store.list(c.lex)},n.parse=(r,n)=>{const i={disk:o(),read:(e,r)=>{if(e)return n(e);if(!r)return n(t,i.disk);let o=[],s=i.split(r);for(;s;){let e,t,r=s[1];s=i.split(s[2])||"","#"===s[0]&&(e=s[1],o=o.slice(0,r),r<=o.length&&o.push(e)),s=i.split(s[2])||"","\n"!==s[0]&&("="===s[0]&&(t=s[1]),void 0!==e&&void 0!==t&&i.disk(o.join(""),t),s=i.split(s[2]))}n(t,i.disk)},split:e=>{if(!e)return;let t=-1,r="",o=null;for(;(o=e[++t])&&o!==l;)r+=o;let n={};return o?[r,u.decode(e.slice(t),n),e.slice(t+n.i)]:void 0}};e.store.get(r,i.read)},n};u.encode=e=>{let t="";if(e instanceof Array&&2===e.length&&(t=i+e[1],e=e[0]),"string"==typeof e){let r=0,o=null,n=l;for(;o=e[r++];)o===l&&(n+=l);return n+'"'+e+t+l}const r=n.rel.is(e);return r?l+"#"+r+t+l:n.num.is(e)?l+"+"+(e||0)+t+l:!0===e?l+"+"+t+l:!1===e?l+"-"+t+l:null===e?l+" "+t+l:void 0},u.decode=(e,t)=>{var r="",o=-1,s=0,u=null,c=null;if(e[0]!==l)return;for(;u=e[++o];)if(c){if(u===l&&--s<=0)break;r+=u}else u===l?s++:c=u||!0;t&&(t.i=o+1);let[a,f]=r.split(i);if(f){if(f=parseFloat(f),'"'===c)return[a,f];if("#"===c)return[n.rel.ify(a),f];if("+"===c)return 0===a.length?[!0,f]:[parseFloat(a),f];if("-"===c)return[!1,f];if(" "===c)return[null,f]}else{if('"'===c)return r;if("#"===c)return n.rel.ify(r);if("+"===c)return 0===r.length||parseFloat(r);if("-"===c)return!1;if(" "===c)return null}},e.exports=u},62:(e,t,r)=>{const o=r(413),n=String.fromCharCode(29),i=String.fromCharCode(30),s=()=>{const e=(t,r,s)=>{if(s||(e[n]||(e[n]={}),s=e[n]),!t)return s;let l=0,u={},c=t[l];const a=t.length-1,f=void 0===r;let d=s[c];for(;!d&&l<a;)c+=t[++l],d=s[c];if(d){if(l!==a)return d[n]||f||(d[n]={}),e(t.slice(++l),r,d[n]);if(f)return void 0===d[i]?d[n]:d[i];d[i]=r}else if(o.obj.map(s,((e,o)=>{let l=0,c="";for(;o[l]===t[l];)c+=o[l++];if(c){if(f){if(l<=a)return;return u[o.slice(l)]=e,e}let d={[o.slice(l)]:e,[t.slice(l)]:{[i]:r}};return s[c]={[n]:d},delete s[o],!0}}))){if(f)return u}else{if(f)return;s[c]||(s[c]={}),s[c][i]=r}};return e};s.map=function e(t,r,o,s){s||(s=[]);var l=t[n]||t,u=Object.keys(l).sort();for(let t=0;t<u.length;t++){let c=u[t],a=l[c],f=a[i];if(void 0!==f){if(f=r(f,s.join("")+c,c,s),void 0!==f)return f}else o&&r(void 0,s.join(""),c,s);if(a[n]){if(s.push(c),f=e(a[n],r,o,s),void 0!==f)return f;s.pop()}}},e.exports=s},621:(e,t,r)=>{const o=r(127),n=r(166),i=r(62),s=r(413),l=String.fromCharCode(5),u=String.fromCharCode(31);e.exports=e=>{s.obj.is(e)||(e={}),e.file=String(e.file||"radata"),e.store||(e.store=(e=>{if(o.isNode){const t=r(603);return t.existsSync(e)||t.mkdirSync(e),t.existsSync(e+"/!")||t.writeFileSync(e+"/!",u+"+0"+u+"#"+u+'"root'+u),{get:(r,o)=>{t.readFile(e+"/"+r,((e,t)=>{if(e){if("ENOENT"===e.code)return void o();console.log("filesystem error:",e)}t&&(t=t.toString()),o(e,t)}))},put:(r,o,n)=>{var i=Math.random().toString(36).slice(-9),s=r+"."+i+".tmp";t.writeFile(s,o,(o=>{o?n(o):t.rename(s,e+"/"+r,n)}))},list:r=>{t.readdir(e,((e,t)=>{t.forEach(r),r()}))}}}return{get:(e,t)=>{t(null,u+"+0"+u+"#"+u+'"root'+u)},put:(e,t,r)=>{r(null)},list:e=>{e("!"),e()}}})(e.file));const t=n(e);return{get:(e,r)=>{if(!e)return void r("lex required");var o,n=e["#"],u=e["."]||"";const c=(e,t)=>{o||(o={_:{"#":n,">":{}}}),o[t]=e[0],o._[">"][t]=e[1]};t(n+l+u,((e,t)=>{let l;s.obj.is(t)?(i.map(t,c),o||c(t,u),l={[n]:o}):t&&(c(t,u),l={[n]:o}),r(e,l)}))},put:(e,r)=>{if(!e)return void r("graph required");var o=0;const n=e=>{o--,n.err||(n.err=e,n.err?r(n.err):0===o&&r(null))};Object.keys(e).forEach((r=>{var i=e[r];Object.keys(i).forEach((e=>{if("_"===e)return;o++;let s=i[e],u=i._[">"][e];t(r+l+e,[s,u],n)}))}))}}}},413:e=>{const t={is:e=>!(e instanceof Array)&&(e-parseFloat(e)+1>=0||1/0===e||-1/0===e)},r={is:e=>!!e&&(e instanceof Object&&e.constructor===Object||"Object"===Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1]),map:(e,t,r)=>{var o=Object.keys(e);for(let n=0;n<o.length;n++){let i=t(e[o[n]],o[n],r);if(void 0!==i)return i}},put:(e,t,r)=>(e||(e={}),e[t]=r,e),del:(e,t)=>{if(e)return e[t]=null,delete e[t],e}},o=(e,t,r)=>{r.id?r.id=!1:r.id="#"===t&&"string"==typeof e&&e},n={is:e=>{if(e&&e["#"]&&!e._&&r.is(e)){let t={};if(r.map(e,o,t),t.id)return t.id}return!1},ify:e=>r.put({},"#",e)},i={random:e=>{var t="";e||(e=24);for(let r=0;r<e;r++)t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(61*Math.random()));return t}};e.exports={num:t,obj:r,rel:n,text:i}},643:(e,t,r)=>{const o=r(127),n=r(45),i=r(664),s=r(626),l=r(621),u=r(413);e.exports=e=>{u.obj.is(e)||(e={});const t=n(e.maxAge),c=l(e);var a={},f={};const d=(e,r)=>{const o=i(e.get,a);o?r(JSON.stringify({"#":t.track(u.text.random(9)),"@":e["#"],put:o})):c.get(e.get,((o,n)=>{r(JSON.stringify({"#":t.track(u.text.random(9)),"@":e["#"],put:n,err:o}))}))},p=(e,r)=>{const o=s.mix(e.put,a);c.put(o.now,(o=>{r(JSON.stringify({"#":t.track(u.text.random(9)),"@":e["#"],err:o}))})),0!==o.wait&&setTimeout((()=>p({put:o.defer},r)),o.wait)},g=e=>({get:(r,o,n)=>{if(!o)return;u.obj.is(n)||(n={});const s=i(r,a);s?o({put:s}):c.get(r,((i,s)=>{if(s)return void o({put:s,err:i});i&&console.log(i);const l=u.text.random(9);f[l]=o,e(JSON.stringify({"#":t.track(l),get:r})),setTimeout((()=>{const e=f[l];if(e){const t=r["#"],o={[t]:null};r["."]&&(o[t]={[r["."]]:null}),e({put:o}),delete f[l]}}),n.wait||100)}))},put:(r,o)=>{const n=s.mix(r,a);c.put(n.now,o),e(JSON.stringify({"#":t.track(u.text.random(9)),put:r}))}});if(o.isNode){const o=r(591);let n=e.wss,i=()=>n.clients();n||(n=new o.Server({port:8080}),i=()=>n.clients);const s=(e,t)=>{i().forEach((r=>{r.readyState===o.OPEN&&r.send(e,{binary:t})}))};return n.on("connection",(e=>{e.on("error",console.error),e.on("message",((e,r)=>{const o=JSON.parse(e);if(t.check(o["#"]))return;t.track(o["#"]),o.get&&d(o,s),o.put&&p(o,s),s(e,r);const n=o["@"],i=f[n];i&&(delete o["#"],delete o["@"],i(o),delete f[n])}))})),g(s)}let h=new WebSocket("ws://localhost:8080");const b=e=>{h&&h.readyState===WebSocket.OPEN?h.send(e):console.log("websocket not available")},v=()=>{h||(h=new WebSocket("ws://localhost:8080")),h.onclose=e=>{h=null,setTimeout(v,Math.floor(5e3*Math.random()))},h.onerror=e=>{console.error(e)},h.onmessage=e=>{const r=JSON.parse(e.data);if(t.check(r["#"]))return;t.track(r["#"]),r.get&&d(r,b),r.put&&p(r,b),b(e.data);const o=r["@"],n=f[o];n&&(delete r["#"],delete r["@"],n(r),delete f[o])}};return v(),g(b)}},603:()=>{}},t={},r=function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}(299);Holster=r})();
//# sourceMappingURL=holster.min.js.map