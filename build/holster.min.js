(()=>{var e={127:e=>{var t,r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};((e,t)=>{for(var n in t)r(e,n,{get:t[n],enumerable:!0})})(s,{isBrowser:()=>l,isBun:()=>d,isDeno:()=>f,isJsDom:()=>a,isNode:()=>u,isWebWorker:()=>c}),e.exports=(t=s,((e,t,s,l)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of o(t))i.call(e,s)||undefined===s||r(e,s,{get:()=>t[s],enumerable:!(l=n(t,s))||l.enumerable});return e})(r({},"__esModule",{value:!0}),t));var l="undefined"!=typeof window&&void 0!==window.document,u="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,c="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,a="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&"userAgent"in navigator&&"string"==typeof navigator.userAgent&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),f="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,d="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.bun},591:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},45:e=>{e.exports=e=>{e||(e=9e3);const t={store:{},check:e=>!!t.store[e]&&t.track(e),track:r=>(t.store[r]=Date.now(),t.expiry||(t.expiry=setTimeout((()=>{const r=Date.now();Object.keys(t.store).forEach((n=>{r-t.store[n]>e&&delete t.store[n]})),t.expiry=null}),e)),r)};return t}},664:e=>{e.exports=(e,t)=>{const r=e["#"],n=e["."];var o=t[r];if(!o||!n)return;let i=o[n];return i?((o={_:o._,[n]:i})._[">"]={[n]:o._[">"][n]},{[r]:o}):void 0}},626:e=>{const t=(e,t,r,n)=>e<t?{historical:!0}:e>t?{incoming:!0}:("string"!=typeof r&&(r=JSON.stringify(r)||""),"string"!=typeof n&&(n=JSON.stringify(n)||""),r===n?{state:!0}:r<n?{current:!0}:{incoming:!0});t.mix=(e,r)=>{var n=Date.now(),o={},i={};let s=0;return Object.keys(e).forEach((l=>{const u=e[l];Object.keys(u).forEach((e=>{if("_"===e)return;const c=u[e],a=u._[">"][e],f=(r[l]||{})[e],d=(r[l]||{_:{">":{}}})._[">"][e]||0,p=a-n;if(p>0){if(p>864e5)return;(0===s||p<s)&&(s=p),i[l]||(i[l]={_:{"#":l,">":{}}}),i[l][e]=c,i[l]._[">"][e]=a}else t(a,d,c,f).incoming&&(o[l]||(o[l]={_:{"#":l,">":{}}}),r[l]||(r[l]={_:{"#":l,">":{}}}),r[l][e]=o[l][e]=c,r[l]._[">"][e]=o[l]._[">"][e]=a)}))})),{now:o,defer:i,wait:s}},e.exports=t},299:(e,t,r)=>{const n=r(413),o=r(643);e.exports=e=>{const t=o(e),r=e=>null===e||!0===e||!1===e||"string"==typeof e||n.rel.is(e)||n.num.is(e),i=(e,t,r)=>{r?r[e]={_:{"#":e,">":{}}}:r={[e]:{_:{"#":e,">":{}}}};for(const[n,o]of Object.entries(t))r[e][n]=o,r[e]._[">"][n]=Date.now();return r},s=e=>{s.ctx=e;const o=(e,r)=>{const o=void 0!==e.get;for(let l=1;l<s.ctx.length;l++){if(null!==s.ctx[l].soul)continue;const{item:u,soul:c}=s.ctx[l-1];return t.get({"#":c,".":u},(a=>{if(a.err)return console.log(`error getting ${u} on ${c}: ${a.err}`),void r(null);if(0===s.ctx.length)return;const f=a.put&&a.put[c];if(f&&"undefined"!==f[u]){let a=n.rel.is(f[u]);if(a)s.ctx[l].soul=a,o?s(s.ctx).get(null,e.get,r):s(s.ctx).put(e.put,r);else if(o)r(f[u]);else{a=n.text.random();const o={[u]:n.rel.ify(a)};t.put(i(c,o),(t=>{t?ack(`error putting ${u} on ${c}: ${t}`):(s.ctx[l].soul=a,s(s.ctx).put(e.put,r))}))}}else console.log(`error ${u} not found on ${c}`),r(null)})),!1}return o&&null!==s.ctx[s.ctx.length-1].item?(s.ctx.push({item:null,soul:null}),s(s.ctx).get(null,e.get,r),!1):s.ctx[s.ctx.length-1]},l=e=>{if(s.ctx&&(s.ctx=[]),s.cb){const t=s.cb;return s.cb=null,void t(e)}e&&console.log(e)};return{get:(e,r,i)=>{if("function"==typeof r&&(i=r,r=null),s.cb||(s.cb=i),""===e||"_"===e)return l(null),s(s.ctx);if(s.ctx&&0!==s.ctx.length)null!==e&&s.ctx.push({item:e,soul:null});else{if(null===e)return l(null),s(s.ctx);s.ctx=[{item:e,soul:"root"}]}if(!s.cb)return s(s.ctx);const{soul:u}=o({get:r},l);return u?(t.get(n.obj.put(r,"#",u),(e=>{e.err&&console.log(e.err),e.put&&e.put[u]?(delete e.put[u]._,l(e.put[u])):l(null)})),s(s.ctx)):s(s.ctx)},put:(e,u)=>{if(!s.cb){if(!u)return;s.cb=u,u=null}const c=e=>{u?u(e):l(e)};if(!s.ctx||0===s.ctx.length)return void c("please provide a key using get(key) before put");const a=(e=>{if(r(e))return!0;if(n.obj.is(e)){const t=[];for(const[o,i]of Object.entries(e)){if("_"===o)return"error underscore cannot be used as an item name";if(!n.obj.is(i)&&!r(i))return`error {${o}:${i}} cannot be converted to graph`;t.push(o)}if(0!==t.length)return t}return`error ${e} cannot be converted to a graph`})(e);if("string"==typeof a)return void c(a);const{item:f,soul:d}=o({put:e},c);d&&(!0!==a?t.get({"#":d,".":f},(async r=>{if(r.err)return void c(`error getting ${d}: ${r.err}`);const o=r.put&&r.put[d]&&r.put[d][f],l=n.rel.is(o);if(!l){const r={[f]:n.rel.ify(n.text.random())};return void t.put(i(d,r),(t=>{t?c(`error putting ${f} on ${d}: ${t}`):s(s.ctx).put(e,c)}))}let u=!1;const p={};for(let t=0;t<a.length;t++){const r=a[t],o=await new Promise((t=>{n.obj.is(e[r])?s([{item:r,soul:l}]).put(e[r],t):(u=!0,p[r]=e[r],t(null))}));if(o)return void c(o)}u?t.put(i(l,p),c):c()})):t.put(i(d,{[f]:e}),c))},wire:t}};return s()}},166:(e,t,r)=>{const n=r(62),o=r(413),i=String.fromCharCode(3),s=String.fromCharCode(5),l=String.fromCharCode(31),u=e=>{var t,r=null;if(e||(e={}),e.log||(e.log=console.log),e.batch||(e.batch=1e4),e.wait||(e.wait=1),e.size||(e.size=1048576),!e.store)return void e.log("Radisk needs `store` interface with `{get: fn, put: fn, list: fn}`");if(!e.store.get)return void e.log("Radisk needs `store.get` interface with `(file, cb)`");if(!e.store.put)return void e.log("Radisk needs `store.put` interface with `(file, data, cb)`");if(!e.store.list)return void e.log("Radisk needs a streaming `store.list` interface with `(cb)`");const o=(r,n,i)=>(r=""+r,"function"==typeof n?(i=n,void 0!==(n=o.batch(r))||o.thrash.at&&void 0!==(n=o.thrash.at(r))?i(t,n):o.read(r,i)):(o.batch(r,n),i&&o.batch.acks.push(i),++o.batch.ed>=e.batch?o.thrash():(clearTimeout(o.batch.timeout),void(o.batch.timeout=setTimeout(o.thrash,e.wait)))));return o.batch=n(),o.batch.acks=[],o.batch.ed=0,o.thrash=()=>{if(o.thrash.ing)return o.thrash.more=!0;clearTimeout(o.batch.timeout),o.thrash.more=!1,o.thrash.ing=!0;var t=o.thrash.at=o.batch;o.batch=null,o.batch=n(),o.batch.acks=[],o.batch.ed=0;let r=0;o.save(t,(n=>{++r>1||(n&&e.log(n),t.acks.forEach((e=>e(n))),o.thrash.at=null,o.thrash.ing=!1,o.thrash.more&&o.thrash())}))},o.save=(r,i)=>{const s={find:(t,r)=>{if(!(r<s.start))return s.start=r,e.store.list(s.lex),!0},lex:e=>{if(!e||e>s.start)return s.end=e,s.mix(s.file||"!",s.start,s.end),!0;s.file=e},mix:(e,l,u)=>{s.start=s.end=s.file=t,o.parse(e,((t,c)=>{if(t)return i(t);n.map(r,((e,t)=>{if(!(t<l))return u&&u<t?(s.start=t,s.start):void c(t,e)})),o.write(e,c,s.next)}))},next:e=>e?i(e):s.start?n.map(r,s.find):void i(e)};n.map(r,s.find)},o.write=(t,i,l)=>{r=null;const c={text:"",count:0,file:t,each:(t,r,o,s)=>{c.count++;var l=u.encode(s.length)+"#"+u.encode(o)+(void 0===t?"":"="+u.encode(t))+"\n";if(c.count>1&&c.text.length+l.length>e.size)return c.text="",c.limit=Math.ceil(c.count/2),c.count=0,c.sub=n(),n.map(i,c.slice),!0;c.text+=l},put:()=>{e.store.put(t,c.text,l)},slice:(e,t)=>{if(!(t<c.file)){if(++c.count>c.limit){var r=c.file;let e=t.indexOf(s);return c.file=-1===e?t:t.substring(0,e),c.sub(c.file,null),c.count=0,o.write(r,c.sub,c.next),!0}c.sub(t,e)}},next:e=>{if(e)return l(e);c.sub=n(),n.map(i,c.slice)||o.write(c.file,c.sub,l)}};n.map(i,c.each,!0)||c.put()},o.read=(n,i)=>{if(r){let e=r(n);if(void 0!==e)return i(t,e)}let l=n,u=n.indexOf(s);-1!==u&&(l=n.substring(0,u));const c={lex:e=>{if(!e)return c.file?void o.parse(c.file,c.it):void i("no file found",t);e>l||e<c.file||(c.file=e)},it:(t,o)=>{t&&e.log(t),o&&(r=o,c.value=o(n)),i(t,c.value)}};e.store.list(c.lex)},o.parse=(r,o)=>{const i={disk:n(),read:(e,r)=>{if(e)return o(e);if(!r)return o(t,i.disk);let n=[],s=i.split(r);for(;s;){let e,t,r=s[1];s=i.split(s[2])||"","#"===s[0]&&(e=s[1],n=n.slice(0,r),r<=n.length&&n.push(e)),s=i.split(s[2])||"","\n"!==s[0]&&("="===s[0]&&(t=s[1]),void 0!==e&&void 0!==t&&i.disk(n.join(""),t),s=i.split(s[2]))}o(t,i.disk)},split:e=>{if(!e)return;let t=-1,r="",n=null;for(;(n=e[++t])&&n!==l;)r+=n;let o={};return n?[r,u.decode(e.slice(t),o),e.slice(t+o.i)]:void 0}};e.store.get(r,i.read)},o};u.encode=e=>{let t="";if(e instanceof Array&&2===e.length&&(t=i+e[1],e=e[0]),"string"==typeof e){let r=0,n=null,o=l;for(;n=e[r++];)n===l&&(o+=l);return o+'"'+e+t+l}const r=o.rel.is(e);return r?l+"#"+r+t+l:o.num.is(e)?l+"+"+(e||0)+t+l:!0===e?l+"+"+t+l:!1===e?l+"-"+t+l:null===e?l+" "+t+l:void 0},u.decode=(e,t)=>{var r="",n=-1,s=0,u=null,c=null;if(e[0]!==l)return;for(;u=e[++n];)if(c){if(u===l&&--s<=0)break;r+=u}else u===l?s++:c=u||!0;t&&(t.i=n+1);let[a,f]=r.split(i);if(f){if(f=parseFloat(f),'"'===c)return[a,f];if("#"===c)return[o.rel.ify(a),f];if("+"===c)return 0===a.length?[!0,f]:[parseFloat(a),f];if("-"===c)return[!1,f];if(" "===c)return[null,f]}else{if('"'===c)return r;if("#"===c)return o.rel.ify(r);if("+"===c)return 0===r.length||parseFloat(r);if("-"===c)return!1;if(" "===c)return null}},e.exports=u},62:(e,t,r)=>{const n=r(413),o=String.fromCharCode(29),i=String.fromCharCode(30),s=()=>{const e=(t,r,s)=>{if(s||(e[o]||(e[o]={}),s=e[o]),!t)return s;let l=0,u={},c=t[l];const a=t.length-1,f=void 0===r;let d=s[c];for(;!d&&l<a;)c+=t[++l],d=s[c];if(d){if(l!==a)return d[o]||f||(d[o]={}),e(t.slice(++l),r,d[o]);if(f)return void 0===d[i]?d[o]:d[i];d[i]=r}else if(n.obj.map(s,((e,n)=>{let l=0,c="";for(;n[l]===t[l];)c+=n[l++];if(c){if(f){if(l<=a)return;return u[n.slice(l)]=e,e}let d={[n.slice(l)]:e,[t.slice(l)]:{[i]:r}};return s[c]={[o]:d},delete s[n],!0}}))){if(f)return u}else{if(f)return;s[c]||(s[c]={}),s[c][i]=r}};return e};s.map=function e(t,r,n,s){s||(s=[]);var l=t[o]||t,u=Object.keys(l).sort();for(let t=0;t<u.length;t++){let c=u[t],a=l[c],f=a[i];if(void 0!==f){if(f=r(f,s.join("")+c,c,s),void 0!==f)return f}else n&&r(void 0,s.join(""),c,s);if(a[o]){if(s.push(c),f=e(a[o],r,n,s),void 0!==f)return f;s.pop()}}},e.exports=s},621:(e,t,r)=>{const n=r(127),o=r(166),i=r(62),s=r(413),l=String.fromCharCode(5),u=String.fromCharCode(31);e.exports=e=>{s.obj.is(e)||(e={}),e.file=String(e.file||"radata"),e.store||(e.store=(e=>{if(n.isNode){const t=r(603);return t.existsSync(e)||t.mkdirSync(e),t.existsSync(e+"/!")||t.writeFileSync(e+"/!",u+"+0"+u+"#"+u+'"root'+u),{get:(r,n)=>{t.readFile(e+"/"+r,((e,t)=>{if(e){if("ENOENT"===e.code)return void n();console.log("filesystem error:",e)}t&&(t=t.toString()),n(e,t)}))},put:(r,n,o)=>{var i=Math.random().toString(36).slice(-9),s=r+"."+i+".tmp";t.writeFile(s,n,(n=>{n?o(n):t.rename(s,e+"/"+r,o)}))},list:r=>{t.readdir(e,((e,t)=>{t.forEach(r),r()}))}}}return{get:(e,t)=>{t(null,u+"+0"+u+"#"+u+'"root'+u)},put:(e,t,r)=>{r(null)},list:e=>{e("!"),e()}}})(e.file));const t=o(e);return{get:(e,r)=>{if(!e)return void r("lex required");var n,o=e["#"],u=e["."]||"";const c=(e,t)=>{n||(n={_:{"#":o,">":{}}}),n[t]=e[0],n._[">"][t]=e[1]};t(o+l+u,((e,t)=>{let l;s.obj.is(t)?(i.map(t,c),n||c(t,u),l={[o]:n}):t&&(c(t,u),l={[o]:n}),r(e,l)}))},put:(e,r)=>{if(!e)return void r("graph required");var n=0;const o=e=>{n--,o.err||(o.err=e,o.err?r(o.err):0===n&&r(null))};Object.keys(e).forEach((r=>{var i=e[r];Object.keys(i).forEach((e=>{if("_"===e)return;n++;let s=i[e],u=i._[">"][e];t(r+l+e,[s,u],o)}))}))}}}},413:e=>{const t={is:e=>!(e instanceof Array)&&(e-parseFloat(e)+1>=0||1/0===e||-1/0===e)},r={is:e=>!!e&&(e instanceof Object&&e.constructor===Object||"Object"===Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1]),map:(e,t,r)=>{var n=Object.keys(e);for(let o=0;o<n.length;o++){let i=t(e[n[o]],n[o],r);if(void 0!==i)return i}},put:(e,t,r)=>(e||(e={}),e[t]=r,e),del:(e,t)=>{if(e)return e[t]=null,delete e[t],e}},n=(e,t,r)=>{r.id?r.id=!1:r.id="#"===t&&"string"==typeof e&&e},o={is:e=>{if(e&&e["#"]&&!e._&&r.is(e)){let t={};if(r.map(e,n,t),t.id)return t.id}return!1},ify:e=>r.put({},"#",e)},i={random:e=>{var t="";e||(e=24);for(let r=0;r<e;r++)t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(61*Math.random()));return t}};e.exports={num:t,obj:r,rel:o,text:i}},643:(e,t,r)=>{const n=r(127),o=r(45),i=r(664),s=r(626),l=r(621),u=r(413);e.exports=e=>{u.obj.is(e)||(e={});const t=o(e.maxAge),c=l(e);var a={},f={};const d=(e,r)=>{const n=i(e.get,a);n?r(JSON.stringify({"#":t.track(u.text.random(9)),"@":e["#"],put:n})):c.get(e.get,((n,o)=>{r(JSON.stringify({"#":t.track(u.text.random(9)),"@":e["#"],put:o,err:n}))}))},p=(e,r)=>{const n=s.mix(e.put,a);c.put(n.now,(n=>{r(JSON.stringify({"#":t.track(u.text.random(9)),"@":e["#"],err:n}))})),0!==n.wait&&setTimeout((()=>p({put:n.defer},r)),n.wait)},g=e=>({get:(r,n,o)=>{if(!n)return;u.obj.is(o)||(o={});const s=i(r,a);s?n({put:s}):c.get(r,((i,s)=>{if(s)return void n({put:s,err:i});i&&console.log(i);const l=u.text.random(9);f[l]=n,e(JSON.stringify({"#":t.track(l),get:r})),setTimeout((()=>{const e=f[l];if(e){const t=r["#"],n={[t]:null};r["."]&&(n[t]={[r["."]]:null}),e({put:n}),delete f[l]}}),o.wait||100)}))},put:(r,n)=>{const o=s.mix(r,a);c.put(o.now,n),e(JSON.stringify({"#":t.track(u.text.random(9)),put:r}))}});if(n.isNode){const n=r(591);let o=e.wss,i=()=>o.clients();o||(o=new n.Server({port:8080}),i=()=>o.clients);const s=(e,t)=>{i().forEach((r=>{r.readyState===n.OPEN&&r.send(e,{binary:t})}))};return o.on("connection",(e=>{e.on("error",console.error),e.on("message",((e,r)=>{const n=JSON.parse(e);if(t.check(n["#"]))return;t.track(n["#"]),n.get&&d(n,s),n.put&&p(n,s),s(e,r);const o=n["@"],i=f[o];i&&(delete n["#"],delete n["@"],i(n),delete f[o])}))})),g(s)}let h=new WebSocket("ws://localhost:8080");const b=e=>{h&&h.readyState===WebSocket.OPEN?h.send(e):console.log("websocket not available")},m=()=>{h||(h=new WebSocket("ws://localhost:8080")),h.onclose=e=>{h=null,setTimeout(m,Math.floor(5e3*Math.random()))},h.onerror=e=>{console.error(e)},h.onmessage=e=>{const r=JSON.parse(e.data);if(t.check(r["#"]))return;t.track(r["#"]),r.get&&d(r,b),r.put&&p(r,b),b(e.data);const n=r["@"],o=f[n];o&&(delete r["#"],delete r["@"],o(r),delete f[n])}};return m(),g(b)}},603:()=>{}},t={},r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(299);Holster=r})();
//# sourceMappingURL=holster.min.js.map