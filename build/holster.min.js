(()=>{var t={127:t=>{var e,r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};((t,e)=>{for(var n in e)r(t,n,{get:e[n],enumerable:!0})})(s,{isBrowser:()=>l,isBun:()=>d,isDeno:()=>f,isJsDom:()=>a,isNode:()=>u,isWebWorker:()=>c}),t.exports=(e=s,((t,e,s,l)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of o(e))i.call(t,s)||undefined===s||r(t,s,{get:()=>e[s],enumerable:!(l=n(e,s))||l.enumerable});return t})(r({},"__esModule",{value:!0}),e));var l="undefined"!=typeof window&&void 0!==window.document,u="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,c="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,a="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&"userAgent"in navigator&&"string"==typeof navigator.userAgent&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),f="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,d="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.bun},591:t=>{"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},45:t=>{t.exports=t=>{t||(t=9e3);const e={store:{},check:t=>!!e.store[t]&&e.track(t),track:r=>(e.store[r]=Date.now(),e.expiry||(e.expiry=setTimeout((()=>{const r=Date.now();Object.keys(e.store).forEach((n=>{r-e.store[n]>t&&delete e.store[n]})),e.expiry=null}),t)),r)};return e}},664:t=>{t.exports=(t,e)=>{const r=t["#"],n=t["."];var o=e[r];if(!o||!n)return;let i=o[n];return i?((o={_:o._,[n]:i})._[">"]={[n]:o._[">"][n]},{[r]:o}):void 0}},626:t=>{const e=(t,e,r,n)=>t<e?{historical:!0}:t>e?{incoming:!0}:("string"!=typeof r&&(r=JSON.stringify(r)||""),"string"!=typeof n&&(n=JSON.stringify(n)||""),r===n?{state:!0}:r<n?{current:!0}:{incoming:!0});e.mix=(t,r)=>{var n=Date.now(),o={},i={};let s=0;return Object.keys(t).forEach((l=>{const u=t[l];Object.keys(u).forEach((t=>{if("_"===t)return;const c=u[t],a=u._[">"][t],f=(r[l]||{})[t],d=(r[l]||{_:{">":{}}})._[">"][t]||0,p=a-n;if(p>0){if(p>864e5)return;(0===s||p<s)&&(s=p),i[l]||(i[l]={_:{"#":l,">":{}}}),i[l][t]=c,i[l]._[">"][t]=a}else e(a,d,c,f).incoming&&(o[l]||(o[l]={_:{"#":l,">":{}}}),r[l]||(r[l]={_:{"#":l,">":{}}}),r[l][t]=o[l][t]=c,r[l]._[">"][t]=o[l]._[">"][t]=a)}))})),{now:o,defer:i,wait:s}},t.exports=e},299:(t,e,r)=>{const n=r(413),o=r(643);t.exports=t=>{const e=o(t),r=t=>null===t||!0===t||!1===t||"string"==typeof t||n.rel.is(t)||n.num.is(t),i=(t,e,r)=>{r?r[t]={_:{"#":t,">":{}}}:r={[t]:{_:{"#":t,">":{}}}};for(const[n,o]of Object.entries(e))r[t][n]=o,r[t]._[">"][n]=Date.now();return r},s=t=>{s.ctx=t;const o=(t,r)=>{const o=void 0!==t.get;for(let i=1;i<s.ctx.length;i++){if(null!==s.ctx[i].soul)continue;const{item:l,soul:u}=s.ctx[i-1];return e.get({"#":u,".":l},(e=>{if(e.err)return console.log(`error getting ${l} on ${u}: ${e.err}`),void r(null);if(0===s.ctx.length)return;const c=e.put&&e.put[u];if(c&&"undefined"!==c[l]){const e=n.rel.is(c[l]);e?s.ctx[i].soul=e:(s.ctx[i].property=l,s.ctx[i].soul=u),o?s(s.ctx).get(null,t.get,r):s(s.ctx).put(t.put,r)}else console.log(`error ${l} not found on ${u}`),r(null)})),!1}return o&&null!==s.ctx[s.ctx.length-1].item?(s.ctx.push({item:null,soul:null}),s(s.ctx).get(null,t.get,r),!1):s.ctx[s.ctx.length-1]},l=t=>{if(s.ctx&&(s.ctx=[]),s.cb){const e=s.cb;return s.cb=null,void e(t)}t&&console.log(t)};return{get:(t,r,i)=>{if("function"==typeof r&&(i=r,r=null),s.cb||(s.cb=i),""===t||"_"===t)return l(null),s(s.ctx);if(s.ctx&&0!==s.ctx.length)null!==t&&s.ctx.push({item:t,soul:null});else{if(null===t)return l(null),s(s.ctx);s.ctx=[{item:t,soul:"root"}]}if(!s.cb)return s(s.ctx);const{property:u,soul:c}=o({get:r},l);return c?(e.get(n.obj.put(r,"#",c),(t=>{t.err&&console.log(t.err),t.put&&t.put[c]?void 0!==t.put[c][u]?l(t.put[c][u]):(delete t.put[c]._,l(t.put[c])):l(null)})),s(s.ctx)):s(s.ctx)},put:(t,u)=>{if(!s.cb){if(!u)return;s.cb=u,u=null}const c=t=>{u?u(t):l(t)};if(!s.ctx||0===s.ctx.length)return void c("please provide a key using get(key) before put");const a=(t=>{if(r(t))return!0;if(n.obj.is(t)){const e=[];for(const[o,i]of Object.entries(t)){if("_"===o)return"error underscore cannot be used as an item name";if(!n.obj.is(i)&&!r(i))return`error {${o}:${i}} cannot be converted to graph`;e.push(o)}if(0!==e.length)return e}return`error ${t} cannot be converted to a graph`})(t);if("string"==typeof a)return void c(a);const{item:f,soul:d}=o({put:t},c);d&&(!0!==a?e.get({"#":d,".":f},(async r=>{if(r.err)return void c(`error getting ${d}: ${r.err}`);const o=r.put&&r.put[d]&&r.put[d][f],l=n.rel.is(o);if(!l){const r={[f]:n.rel.ify(n.text.random())};return void e.put(i(d,r),(e=>{e?c(`error putting ${f} on ${d}: ${e}`):s(s.ctx).put(t,c)}))}let u=!1;const p={};for(let e=0;e<a.length;e++){const r=a[e],o=await new Promise((e=>{n.obj.is(t[r])?s([{item:r,soul:l}]).put(t[r],e):(u=!0,p[r]=t[r],e(null))}));if(o)return void c(o)}u?e.put(i(l,p),c):c()})):e.put(i(d,{[f]:t}),c))},wire:e}};return s()}},166:(t,e,r)=>{const n=r(62),o=r(413),i=String.fromCharCode(3),s=String.fromCharCode(5),l=String.fromCharCode(31),u=t=>{var e,r=null;if(t||(t={}),t.log||(t.log=console.log),t.batch||(t.batch=1e4),t.wait||(t.wait=1),t.size||(t.size=1048576),!t.store)return void t.log("Radisk needs `store` interface with `{get: fn, put: fn, list: fn}`");if(!t.store.get)return void t.log("Radisk needs `store.get` interface with `(file, cb)`");if(!t.store.put)return void t.log("Radisk needs `store.put` interface with `(file, data, cb)`");if(!t.store.list)return void t.log("Radisk needs a streaming `store.list` interface with `(cb)`");const o=(r,n,i)=>(r=""+r,"function"==typeof n?(i=n,void 0!==(n=o.batch(r))||o.thrash.at&&void 0!==(n=o.thrash.at(r))?i(e,n):o.read(r,i)):(o.batch(r,n),i&&o.batch.acks.push(i),++o.batch.ed>=t.batch?o.thrash():(clearTimeout(o.batch.timeout),void(o.batch.timeout=setTimeout(o.thrash,t.wait)))));return o.batch=n(),o.batch.acks=[],o.batch.ed=0,o.thrash=()=>{if(o.thrash.ing)return o.thrash.more=!0;clearTimeout(o.batch.timeout),o.thrash.more=!1,o.thrash.ing=!0;var e=o.thrash.at=o.batch;o.batch=null,o.batch=n(),o.batch.acks=[],o.batch.ed=0;let r=0;o.save(e,(n=>{++r>1||(n&&t.log(n),e.acks.forEach((t=>t(n))),o.thrash.at=null,o.thrash.ing=!1,o.thrash.more&&o.thrash())}))},o.save=(r,i)=>{const s={find:(e,r)=>{if(!(r<s.start))return s.start=r,t.store.list(s.lex),!0},lex:t=>{if(!t||t>s.start)return s.end=t,s.mix(s.file||"!",s.start,s.end),!0;s.file=t},mix:(t,l,u)=>{s.start=s.end=s.file=e,o.parse(t,((e,c)=>{if(e)return i(e);n.map(r,((t,e)=>{if(!(e<l))return u&&u<e?(s.start=e,s.start):void c(e,t)})),o.write(t,c,s.next)}))},next:t=>t?i(t):s.start?n.map(r,s.find):void i(t)};n.map(r,s.find)},o.write=(e,i,l)=>{r=null;const c={text:"",count:0,file:e,each:(e,r,o,s)=>{c.count++;var l=u.encode(s.length)+"#"+u.encode(o)+(void 0===e?"":"="+u.encode(e))+"\n";if(c.count>1&&c.text.length+l.length>t.size)return c.text="",c.limit=Math.ceil(c.count/2),c.count=0,c.sub=n(),n.map(i,c.slice),!0;c.text+=l},put:()=>{t.store.put(e,c.text,l)},slice:(t,e)=>{if(!(e<c.file)){if(++c.count>c.limit){var r=c.file;let t=e.indexOf(s);return c.file=-1===t?e:e.substring(0,t),c.sub(c.file,null),c.count=0,o.write(r,c.sub,c.next),!0}c.sub(e,t)}},next:t=>{if(t)return l(t);c.sub=n(),n.map(i,c.slice)||o.write(c.file,c.sub,l)}};n.map(i,c.each,!0)||c.put()},o.read=(n,i)=>{if(r){let t=r(n);if(void 0!==t)return i(e,t)}let l=n,u=n.indexOf(s);-1!==u&&(l=n.substring(0,u));const c={lex:t=>{if(!t)return c.file?void o.parse(c.file,c.it):void i("no file found",e);t>l||t<c.file||(c.file=t)},it:(e,o)=>{e&&t.log(e),o&&(r=o,c.value=o(n)),i(e,c.value)}};t.store.list(c.lex)},o.parse=(r,o)=>{const i={disk:n(),read:(t,r)=>{if(t)return o(t);if(!r)return o(e,i.disk);let n=[],s=i.split(r);for(;s;){let t,e,r=s[1];s=i.split(s[2])||"","#"===s[0]&&(t=s[1],n=n.slice(0,r),r<=n.length&&n.push(t)),s=i.split(s[2])||"","\n"!==s[0]&&("="===s[0]&&(e=s[1]),void 0!==t&&void 0!==e&&i.disk(n.join(""),e),s=i.split(s[2]))}o(e,i.disk)},split:t=>{if(!t)return;let e=-1,r="",n=null;for(;(n=t[++e])&&n!==l;)r+=n;let o={};return n?[r,u.decode(t.slice(e),o),t.slice(e+o.i)]:void 0}};t.store.get(r,i.read)},o};u.encode=t=>{let e="";if(t instanceof Array&&2===t.length&&(e=i+t[1],t=t[0]),"string"==typeof t){let r=0,n=null,o=l;for(;n=t[r++];)n===l&&(o+=l);return o+'"'+t+e+l}const r=o.rel.is(t);return r?l+"#"+r+e+l:o.num.is(t)?l+"+"+(t||0)+e+l:!0===t?l+"+"+e+l:!1===t?l+"-"+e+l:null===t?l+" "+e+l:void 0},u.decode=(t,e)=>{var r="",n=-1,s=0,u=null,c=null;if(t[0]!==l)return;for(;u=t[++n];)if(c){if(u===l&&--s<=0)break;r+=u}else u===l?s++:c=u||!0;e&&(e.i=n+1);let[a,f]=r.split(i);if(f){if(f=parseFloat(f),'"'===c)return[a,f];if("#"===c)return[o.rel.ify(a),f];if("+"===c)return 0===a.length?[!0,f]:[parseFloat(a),f];if("-"===c)return[!1,f];if(" "===c)return[null,f]}else{if('"'===c)return r;if("#"===c)return o.rel.ify(r);if("+"===c)return 0===r.length||parseFloat(r);if("-"===c)return!1;if(" "===c)return null}},t.exports=u},62:(t,e,r)=>{const n=r(413),o=String.fromCharCode(29),i=String.fromCharCode(30),s=()=>{const t=(e,r,s)=>{if(s||(t[o]||(t[o]={}),s=t[o]),!e)return s;let l=0,u={},c=e[l];const a=e.length-1,f=void 0===r;let d=s[c];for(;!d&&l<a;)c+=e[++l],d=s[c];if(d){if(l!==a)return d[o]||f||(d[o]={}),t(e.slice(++l),r,d[o]);if(f)return void 0===d[i]?d[o]:d[i];d[i]=r}else if(n.obj.map(s,((t,n)=>{let l=0,c="";for(;n[l]===e[l];)c+=n[l++];if(c){if(f){if(l<=a)return;return u[n.slice(l)]=t,t}let d={[n.slice(l)]:t,[e.slice(l)]:{[i]:r}};return s[c]={[o]:d},delete s[n],!0}}))){if(f)return u}else{if(f)return;s[c]||(s[c]={}),s[c][i]=r}};return t};s.map=function t(e,r,n,s){s||(s=[]);var l=e[o]||e,u=Object.keys(l).sort();for(let e=0;e<u.length;e++){let c=u[e],a=l[c],f=a[i];if(void 0!==f){if(f=r(f,s.join("")+c,c,s),void 0!==f)return f}else n&&r(void 0,s.join(""),c,s);if(a[o]){if(s.push(c),f=t(a[o],r,n,s),void 0!==f)return f;s.pop()}}},t.exports=s},621:(t,e,r)=>{const n=r(127),o=r(166),i=r(62),s=r(413),l=String.fromCharCode(5),u=String.fromCharCode(31);t.exports=t=>{s.obj.is(t)||(t={}),t.file=String(t.file||"radata"),t.store||(t.store=(t=>{if(n.isNode){const e=r(603);return e.existsSync(t)||e.mkdirSync(t),e.existsSync(t+"/!")||e.writeFileSync(t+"/!",u+"+0"+u+"#"+u+'"root'+u),{get:(r,n)=>{e.readFile(t+"/"+r,((t,e)=>{if(t){if("ENOENT"===t.code)return void n();console.log("filesystem error:",t)}e&&(e=e.toString()),n(t,e)}))},put:(r,n,o)=>{var i=Math.random().toString(36).slice(-9),s=r+"."+i+".tmp";e.writeFile(s,n,(n=>{n?o(n):e.rename(s,t+"/"+r,o)}))},list:r=>{e.readdir(t,((t,e)=>{e.forEach(r),r()}))}}}return{get:(t,e)=>{e(null,u+"+0"+u+"#"+u+'"root'+u)},put:(t,e,r)=>{r(null)},list:t=>{t("!"),t()}}})(t.file));const e=o(t);return{get:(t,r)=>{if(!t)return void r("lex required");var n,o=t["#"],u=t["."]||"";const c=(t,e)=>{n||(n={_:{"#":o,">":{}}}),n[e]=t[0],n._[">"][e]=t[1]};e(o+l+u,((t,e)=>{let l;s.obj.is(e)?(i.map(e,c),n||c(e,u),l={[o]:n}):e&&(c(e,u),l={[o]:n}),r(t,l)}))},put:(t,r)=>{if(!t)return void r("graph required");var n=0;const o=t=>{n--,o.err||(o.err=t,o.err?r(o.err):0===n&&r(null))};Object.keys(t).forEach((r=>{var i=t[r];Object.keys(i).forEach((t=>{if("_"===t)return;n++;let s=i[t],u=i._[">"][t];e(r+l+t,[s,u],o)}))}))}}}},413:t=>{const e={is:t=>!(t instanceof Array)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)},r={is:t=>!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1]),map:(t,e,r)=>{var n=Object.keys(t);for(let o=0;o<n.length;o++){let i=e(t[n[o]],n[o],r);if(void 0!==i)return i}},put:(t,e,r)=>(t||(t={}),t[e]=r,t),del:(t,e)=>{if(t)return t[e]=null,delete t[e],t}},n=(t,e,r)=>{r.id?r.id=!1:r.id="#"===e&&"string"==typeof t&&t},o={is:t=>{if(t&&t["#"]&&!t._&&r.is(t)){let e={};if(r.map(t,n,e),e.id)return e.id}return!1},ify:t=>r.put({},"#",t)},i={random:t=>{var e="";t||(t=24);for(let r=0;r<t;r++)e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(61*Math.random()));return e}};t.exports={num:e,obj:r,rel:o,text:i}},643:(t,e,r)=>{const n=r(127),o=r(45),i=r(664),s=r(626),l=r(621),u=r(413);t.exports=t=>{u.obj.is(t)||(t={});const e=o(t.maxAge),c=l(t);var a={},f={};const d=(t,r)=>{const n=i(t.get,a);n?r(JSON.stringify({"#":e.track(u.text.random(9)),"@":t["#"],put:n})):c.get(t.get,((n,o)=>{r(JSON.stringify({"#":e.track(u.text.random(9)),"@":t["#"],put:o,err:n}))}))},p=(t,r)=>{const n=s.mix(t.put,a);c.put(n.now,(n=>{r(JSON.stringify({"#":e.track(u.text.random(9)),"@":t["#"],err:n}))})),0!==n.wait&&setTimeout((()=>p({put:n.defer},r)),n.wait)},g=t=>({get:(r,n,o)=>{if(!n)return;u.obj.is(o)||(o={});const s=i(r,a);s?n({put:s}):c.get(r,((i,s)=>{if(s)return void n({put:s,err:i});i&&console.log(i);const l=u.text.random(9);f[l]=n,t(JSON.stringify({"#":e.track(l),get:r})),setTimeout((()=>{const t=f[l];if(t){const e=r["#"],n={[e]:null};r["."]&&(n[e]={[r["."]]:null}),t({put:n}),delete f[l]}}),o.wait||100)}))},put:(r,n)=>{const o=s.mix(r,a);c.put(o.now,n),t(JSON.stringify({"#":e.track(u.text.random(9)),put:r}))}});if(n.isNode){const n=r(591);let o=t.wss,i=()=>o.clients();o||(o=new n.Server({port:8080}),i=()=>o.clients);const s=(t,e)=>{i().forEach((r=>{r.readyState===n.OPEN&&r.send(t,{binary:e})}))};return o.on("connection",(t=>{t.on("error",console.error),t.on("message",((t,r)=>{const n=JSON.parse(t);if(e.check(n["#"]))return;e.track(n["#"]),n.get&&d(n,s),n.put&&p(n,s),s(t,r);const o=n["@"],i=f[o];i&&(delete n["#"],delete n["@"],i(n),delete f[o])}))})),g(s)}let h=new WebSocket("ws://localhost:8080");const b=t=>{h&&h.readyState===WebSocket.OPEN?h.send(t):console.log("websocket not available")},v=()=>{h||(h=new WebSocket("ws://localhost:8080")),h.onclose=t=>{h=null,setTimeout(v,Math.floor(5e3*Math.random()))},h.onerror=t=>{console.error(t)},h.onmessage=t=>{const r=JSON.parse(t.data);if(e.check(r["#"]))return;e.track(r["#"]),r.get&&d(r,b),r.put&&p(r,b),b(t.data);const n=r["@"],o=f[n];o&&(delete r["#"],delete r["@"],o(r),delete f[n])}};return v(),g(b)}},603:()=>{}},e={},r=function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}(299);Holster=r})();
//# sourceMappingURL=holster.min.js.map